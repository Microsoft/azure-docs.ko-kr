---
title: 토큰 개요-Azure Active Directory B2C
description: Azure Active Directory B2C에서 사용 되는 토큰에 대해 알아봅니다.
services: active-directory-b2c
author: mmacy
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 08/27/2019
ms.author: marsma
ms.subservice: B2C
ms.openlocfilehash: 543a3558333933e9d8d6262c76c1e6e9419be877
ms.sourcegitcommit: 5d6ce6dceaf883dbafeb44517ff3df5cd153f929
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 01/29/2020
ms.locfileid: "76848188"
---
# <a name="overview-of-tokens-in-azure-active-directory-b2c"></a>Azure Active Directory B2C 토큰 개요

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

Azure AD B2C(Azure Active Directory B2C)는 각 [인증 흐름](application-types.md)을 처리할 때 여러 형식의 보안 토큰을 내보냅니다. 이 문서에서는 각 토큰 유형의 형식, 보안 특성 및 내용을 설명합니다.

## <a name="token-types"></a>토큰 형식

Azure AD B2C는 인증에 토큰을 사용 하 고 리소스에 안전 하 게 액세스 하는 [OAuth 2.0 및 Openid connect Connect 프로토콜](protocols-overview.md)을 지원 합니다. Azure AD B2C에 사용 되는 모든 토큰은 전달자에 대한 정보 어설션과 토큰의 주체를 포함 하는 jwt [(JSON 웹 토큰)](https://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) 입니다.

Azure AD B2C와 통신 하는 데 사용 되는 토큰은 다음과 같습니다.

- *ID token* -응용 프로그램에서 사용자를 식별 하는 데 사용할 수 있는 클레임을 포함 하는 JWT입니다. 이 토큰은 동일한 응용 프로그램 또는 서비스의 두 구성 요소 간 통신을 위해 HTTP 요청에서 안전 하 게 전송 됩니다. 필요에 따라 ID 토큰에서 클레임을 사용할 수 있습니다. 일반적으로 계정 정보를 표시 하거나 응용 프로그램에서 액세스 제어 결정을 내리는 데 사용 됩니다. ID 토큰은 서명 되지만 암호화 되지 않습니다. 응용 프로그램 또는 API가 ID 토큰을 받으면 서명의 유효성을 검사 하 여 토큰이 인증 되었음을 증명 해야 합니다. 또한 응용 프로그램 또는 API는 토큰에 있는 몇 가지 클레임의 유효성을 검사 하 여 유효 하다는 것을 증명 해야 합니다. 시나리오 요구 사항에 따라 응용 프로그램에서 유효성을 검사 하는 클레임은 달라질 수 있지만 응용 프로그램은 모든 시나리오에서 몇 가지 일반적인 클레임 유효성 검사를 수행 해야 합니다.
- *액세스 토큰* -api에 부여 된 사용 권한을 식별 하는 데 사용할 수 있는 클레임을 포함 하는 JWT입니다. 액세스 토큰은 서명 되지만 암호화 되지 않습니다. 액세스 토큰은 Api 및 리소스 서버에 대한 액세스를 제공 하는 데 사용 됩니다.  API에서 액세스 토큰을 받으면 서명의 유효성을 검사 하 여 토큰이 인증 되었음을 증명 해야 합니다. API는 또한 토큰에서 일부 클레임의 유효성을 검사하여 유효하다는 것을 입증해야 합니다. 시나리오 요구 사항에 따라 응용 프로그램에서 유효성을 검사 하는 클레임은 달라질 수 있지만 응용 프로그램은 모든 시나리오에서 몇 가지 일반적인 클레임 유효성 검사를 수행 해야 합니다.
- *새로 고침 토큰* -새로 고침 토큰은 OAuth 2.0 흐름에서 새 ID 토큰 및 액세스 토큰을 가져오는 데 사용 됩니다. 이러한 사용자와의 상호 작용을 요구 하지 않고 사용자를 대신 하 여 리소스에 대한 장기 액세스를 응용 프로그램에 제공 합니다. 새로 고침 토큰은 응용 프로그램에 불투명 합니다. 이러한 사용자는 Azure AD B2C에서 발급 되며 Azure AD B2C만 검사 하 고 해석할 수 있습니다. 수명이 긴 하지만 새로 고침 토큰이 특정 기간 동안 지속 될 것 이란 가정 하에 응용 프로그램을 작성 해서는 안 됩니다. 다양한 이유로 언제든지 새로 고침 토큰이 무효화될 수 있기 때문입니다. 응용 프로그램에서 새로 고침 토큰이 유효한 지 여부를 확인 하는 유일한 방법은 Azure AD B2C에 대한 토큰 요청을 수행 하 여 호출 하는 것입니다. 새 토큰에 대한 새로 고침 토큰을 사용할 경우 토큰 응답에 새로운 새로 고침 토큰을 받게 됩니다. 새 새로 고침 토큰을 저장 합니다. 이전에 요청에서 사용한 새로 고침 토큰을 대체 합니다. 이 작업을 통해 새로 고침 토큰이 최대한 오랫동안 유효한 상태로 유지 되도록 할 수 있습니다.

## <a name="endpoints"></a>엔드포인트

[등록 된 응용 프로그램](tutorial-register-applications.md) 은 토큰을 수신 하 고 다음 엔드포인트으로 요청을 보내 Azure AD B2C와 통신 합니다.

- `https://{tenant}.b2clogin.com/{tenant}.onmicrosoft.com/oauth2/v2.0/authorize`
- `https://{tenant}.b2clogin.com/{tenant}.onmicrosoft.com/oauth2/v2.0/token`

응용 프로그램이 Azure AD B2C에서 수신 하는 보안 토큰은 `/authorize` 또는 `/token` 엔드포인트에서 가져올 수 있습니다. `/authorize` 엔드포인트에서 ID 토큰을 획득 하는 경우 JavaScript 기반 웹 응용 프로그램에 로그인 하는 사용자에 게 자주 사용 되는 [암시적 흐름](implicit-flow-single-page-application.md)을 사용 하 여 수행 됩니다. `/token` 엔드포인트에서 ID 토큰을 가져오는 경우 [인증 코드 흐름](openid-connect.md#get-a-token)을 사용 하 여 수행 되며,이는 브라우저에서 토큰을 숨깁니다.

## <a name="claims"></a>클레임

Azure AD B2C를 사용하는 경우 토큰의 내용에 대해 정교하게 세분화된 조정을 해야 합니다. [사용자 흐름](user-flow-overview.md) 및 사용자 [지정 정책을](custom-policy-overview.md) 구성 하 여 응용 프로그램에 필요한 클레임의 특정 사용자 데이터 집합을 보낼 수 있습니다. 이러한 클레임에는 **displayName** 및 **emailAddress**와 같은 표준 속성이 포함 될 수 있습니다. 애플리케이션에서 이러한 클레임을 사용하여 사용자 및 요청을 안전하게 인증할 수 있습니다.

ID 토큰의 클레임은 특정 순서로 반환 되지 않습니다. 언제 든 지 새 클레임을 ID 토큰에 도입할 수 있습니다. 새 클레임이 도입 될 때 응용 프로그램이 중단 되어서는 안 됩니다. 클레임에 [사용자 지정 사용자 특성](user-flow-custom-attributes.md) 을 포함할 수도 있습니다.

다음 표에서는 Azure AD B2C에서 발급 한 ID 토큰 및 액세스 토큰에서 예측할 수 있는 클레임을 나열 합니다.

| 이름 | 클레임 | 예제 값 | Description |
| ---- | ----- | ------------- | ----------- |
| 대상 | `aud` | `90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6` | 토큰의 의도한 수신자를 식별합니다. Azure AD B2C 대상 사용자는 응용 프로그램 ID입니다. 응용 프로그램은이 값의 유효성을 검사 하 고 일치 하지 않는 경우 토큰을 거부 해야 합니다. 대상은 리소스와 동의어입니다. |
| 발급자 | `iss` |`https://{tenant}.b2clogin.com/775527ff-9a37-4307-8b3d-cc311f58d925/v2.0/` | 토큰을 생성하고 반환하는 STS(보안 토큰 서비스)를 식별합니다. 또한 사용자가 인증 된 디렉터리를 식별 합니다. 응용 프로그램은 발급자 클레임의 유효성을 검사 하 여 토큰이 적절 한 엔드포인트에서 제공 되었는지 확인 해야 합니다. |
| 발급 시간 | `iat` | `1438535543` | epoch 시간으로 표시된, 토큰이 발급된 시간입니다. |
| 만료 시간 | `exp` | `1438539443` | epoch 시간으로 표시된, 토큰이 무효화되는 시간입니다. 응용 프로그램은이 클레임을 사용 하 여 토큰 수명의 유효성을 확인 해야 합니다. |
| 이전이 아님 | `nbf` | `1438535543` | epoch 시간으로 표시된, 토큰이 유효화되는 시간입니다. 이 시간은 일반적으로 토큰이 발급 된 시간과 동일 합니다. 응용 프로그램은이 클레임을 사용 하 여 토큰 수명의 유효성을 확인 해야 합니다. |
| 버전 | `ver` | `1.0` | Azure AD B2C에 정의 된 ID 토큰의 버전입니다. |
| 코드 해시 | `c_hash` | `SGCPtt01wxwfgnYZy2VJtQ` | OAuth 2.0 인증 코드와 함께 토큰이 발급 된 경우에만 ID 토큰에 포함 된 코드 해시입니다. 코드 해시는 인증 코드의 신뢰성이 유효한지 검사하는 데 사용할 수 있습니다. 이 유효성 검사를 수행 하는 방법에 대한 자세한 내용은 [Openid connect Connect 사양](https://openid.net/specs/openid-connect-core-1_0.html)을 참조 하세요.  |
| 액세스 토큰 해시 | `at_hash` | `SGCPtt01wxwfgnYZy2VJtQ` | 토큰이 OAuth 2.0 액세스 토큰과 함께 발급 된 경우에만 ID 토큰에 포함 된 액세스 토큰 해시입니다. 액세스 토큰 해시는 액세스 토큰의 신뢰성이 유효한지 검사하는 데 사용할 수 있습니다. 이 유효성 검사를 수행 하는 방법에 대한 자세한 내용은 [Openid connect Connect 사양](https://openid.net/specs/openid-connect-core-1_0.html) 을 참조 하세요.  |
| nonce | `nonce` | `12345` | nonce는 토큰 재생 공격을 완화하는 데 사용된 전략입니다. 응용 프로그램은 `nonce` 쿼리 매개 변수를 사용 하 여 권한 부여 요청에서 nonce를 지정할 수 있습니다. 요청에 제공한 값은 ID 토큰의 `nonce` 클레임 에서만 수정 되지 않은 상태로 내보내집니다. 이 클레임을 통해 응용 프로그램은 요청에 지정 된 값에 대해 값을 확인할 수 있습니다. 응용 프로그램은 ID 토큰 유효성 검사 프로세스 중에이 유효성 검사를 수행 해야 합니다. |
| 제목 | `sub` | `884408e1-2918-4cz0-b12d-3aa027d7563b` | 응용 프로그램의 사용자와 같이 토큰이 정보를 어설션하는 보안 주체입니다. 이 값은 변경할 수 없으며 재할당 또는 재사용할 수 없습니다. 예를 들어 리소스 액세스에 토큰을 사용할 때 이 값을 사용하면 안전하게 인증 검사를 수행할 수 있습니다. 기본적으로 주체 클레임은 디렉터리에 있는 사용자의 개체 ID로 채워집니다. |
| 인증 컨텍스트 클래스 참조 | `acr` | 적용되지 않음 | 이전 정책 에서만 사용 됩니다. |
| 보안 프레임워크 정책 | `tfp` | `b2c_1_signupsignin1` | ID 토큰을 획득 하는 데 사용 된 정책의 이름입니다. |
| 인증 시간 | `auth_time` | `1438535543` | 사용자가 마지막으로 자격 증명을 입력 한 시간으로, epoch 시간으로 표시 됩니다. 이 인증에는 새 로그인, SSO (Single Sign-On) 세션 또는 다른 로그인 유형이 있습니다. `auth_time`는 응용 프로그램 (또는 사용자)이 Azure AD B2C에 대한 인증 시도를 마지막으로 시작한 시간입니다. 인증에 사용 되는 메서드는 차별화 되지 않습니다. |
| 범위 | `scp` | `Read`| 액세스 토큰에 대한 리소스에 부여 된 권한입니다. 부여 된 여러 사용 권한은 공백으로 구분 됩니다. |
| 권한 있는 주체 | `azp` | `975251ed-e4f5-4efd-abcb-5f1a8f566ab7` | 요청을 시작한 클라이언트 애플리케이션의 **애플리케이션 ID**입니다. |

## <a name="configuration"></a>구성

다음 속성은 Azure AD B2C에서 내보내는 [보안 토큰의 수명을 관리](configure-tokens.md) 하는 데 사용 됩니다.

- **액세스 및 ID 토큰 수명(분)** - OAuth 2.0 전달자 토큰의 수명은 보호된 리소스에 대한 액세스를 얻는 데 사용됩니다. 기본값은 60분입니다. 최소 (포함)는 5 분입니다. 최대 (포함)는 1440 분입니다.

- **새로 고침 토큰 수명 (일)** -새로 고침 토큰을 새 액세스 또는 ID 토큰을 획득 하는 데 사용할 수 있는 최대 기간입니다. 또한 기간에는 응용 프로그램에 `offline_access` 범위가 부여 된 경우 새 새로 고침 토큰을 가져오는 작업도 포함 됩니다. 기본값은 14일입니다. 최소 (포함)는 1 일입니다. 최대 (포함)는 90 일입니다.

- **새로 고침 토큰 슬라이딩 윈도우 수명 (일)** -이 기간이 경과 하면 응용 프로그램에서 획득 한 가장 최근 새로 고침 토큰의 유효 기간에 관계 없이 사용자가 강제로 다시 인증 됩니다. 스위치가 **제한된**으로 설정된 경우 제공될 수 있습니다. **새로 고침 토큰 수명(일)** 값보다 크거나 같아야 합니다. 스위치가 **제한 없는**으로 설정된 경우 특정 값을 제공할 수 없습니다. 기본값은 90 일입니다. 최소 (포함)는 1 일입니다. 최대 (포함)는 365 일입니다.

다음 사용 사례는 이러한 속성을 사용하여 사용하도록 설정됩니다.

- 애플리케이션에서 지속적으로 활성 상태인 한 사용자가 모바일 애플리케이션에 무기한으로 로그인 상태를 유지하도록 허용합니다. 로그인 사용자 흐름에서 **새로 고침 토큰 슬라이딩 창 수명(일)** 을 **제한 없는**으로 설정할 수 있습니다.
- 적절한 액세스 토큰 수명을 설정하여 업계의 보안 및 규정 준수 요구 사항을 충족합니다.

이러한 설정을 암호 재설정 사용자 흐름에는 사용할 수 없습니다.

## <a name="compatibility"></a>호환성

[토큰 호환성을 관리](configure-tokens.md)하는 데 사용 되는 속성은 다음과 같습니다.

- **발급자(iss) 클레임** - 이 속성은 토큰을 발급한 Azure AD B2C 테넌트를 식별합니다. 기본값은 `https://<domain>/{B2C tenant GUID}/v2.0/`입니다. `https://<domain>/tfp/{B2C tenant GUID}/{Policy ID}/v2.0/` 값에는 토큰 요청에 사용 된 Azure AD B2C 테넌트와 사용자 흐름 모두에 대한 Id가 포함 됩니다. 응용 프로그램 또는 라이브러리가 Azure AD B2C [Openid connect Connect 검색 1.0 사양을](https://openid.net/specs/openid-connect-discovery-1_0.html)준수 해야 하는 경우이 값을 사용 합니다.

- **주체(sub) 클레임** - 이 속성은 토큰에서 정보를 어설션하는 엔터티를 식별합니다. 기본값은 사용자의 개체 ID로 토큰의 `sub` 클레임을 채우는 **ObjectID**입니다. **지원 되지 않는** 값은 이전 버전과의 호환성을 위해서만 제공 됩니다. 가능 하면 빨리 **ObjectID** 로 전환 하는 것이 좋습니다.

- **정책 ID를 나타내는 클레임** -이 속성은 토큰 요청에 사용 된 정책 이름이 채워지는 클레임 유형을 식별 합니다. 기본값은 `tfp`입니다. `acr`의 값은 이전 버전과의 호환성을 위해서만 제공 됩니다.

## <a name="pass-through"></a>통과

사용자 경험을 시작 하면 Azure AD B2C는 id 공급자 로부터 액세스 토큰을 받습니다. Azure AD B2C는 이 토큰을 사용하여 해당 사용자에 대한 정보를 검색합니다. [사용자 흐름에서 클레임을 사용 하도록 설정](idp-pass-through-user-flow.md) 하거나 [사용자 지정 정책에서](idp-pass-through-custom.md) Azure AD B2C 등록 하는 응용 프로그램에 토큰을 전달 하는 클레임을 정의 합니다. 응용 프로그램에서 [v2 사용자 흐름](user-flow-versions.md) 을 사용 하 여 토큰을 클레임으로 전달 하는 기능을 활용 해야 합니다.

현재 Azure AD B2C는 Facebook 및 Google을 포함 하는 OAuth 2.0 id 공급자의 액세스 토큰 전달만 지원 합니다. 다른 모든 ID 공급자에 대한 클레임은 빈 상태로 반환됩니다.

## <a name="validation"></a>유효성 검사

토큰의 유효성을 검사 하기 위해 응용 프로그램은 토큰의 서명과 클레임을 모두 확인 해야 합니다. 원하는 언어에 따라 여러 개의 오픈 소스 라이브러리를 사용 하 여 jwt의 유효성을 검사할 수 있습니다. 사용자 고유의 유효성 검사 논리를 구현 하는 대신 이러한 옵션을 탐색 하는 것이 좋습니다.

### <a name="validate-signature"></a>서명 유효성 검사

JWT는 세 개의 세그먼트, *헤더*, *본문*및 *서명을*포함 합니다. 서명 세그먼트는 응용 프로그램에서 신뢰할 수 있도록 토큰의 신뢰성을 확인 하는 데 사용할 수 있습니다. Azure AD B2C 토큰은 RSA 256 등의 업계 표준 비대칭 암호화 알고리즘을 사용하여 서명됩니다.

토큰의 헤더에는 토큰 서명에 사용된 키 및 암호화 방법에 대한 정보가 들어 있습니다.

```
{
        "typ": "JWT",
        "alg": "RS256",
        "kid": "GvnPApfWMdLRi8PDmisFn7bprKg"
}
```

**Alg** 클레임의 값은 토큰에 서명 하는 데 사용 된 알고리즘입니다. **Kid** 클레임의 값은 토큰에 서명 하는 데 사용 된 공개 키입니다. 지정 된 시간에 공개-개인 키 쌍의 집합 중 하나를 사용 하 여 토큰에 서명할 수 Azure AD B2C. Azure AD B2C는 가능한 키 집합을 주기적으로 회전 합니다. 이러한 키 변경을 자동으로 처리 하도록 응용 프로그램을 작성 해야 합니다. Azure AD B2C에서 사용 하는 공개 키에 대한 업데이트를 확인 하는 적절 한 빈도는 24 시간 간격입니다.

Azure AD B2C에는 OpenID Connect 메타데이터 엔드포인트가 있습니다. 응용 프로그램은이 엔드포인트을 사용 하 여 런타임 시 Azure AD B2C에 대한 정보를 요청할 수 있습니다. 이 정보에는 엔드포인트, 토큰 콘텐츠 및 토큰 서명 키가 포함됩니다. Azure AD B2C 테넌트에는 각 정책에 대한 JSON 메타 데이터 문서가 있습니다. 메타데이터 문서는 몇 가지 유용한 정보를 포함하는 JSON 개체입니다. 메타 데이터에는 토큰에 서명 하는 데 사용 되는 공개 키 집합의 위치를 제공 하는 **jwks_uri**포함 되어 있습니다. 이 위치는 여기에 제공 되지만 메타 데이터 문서 및 구문 분석 **jwks_uri**를 사용 하 여 동적으로 위치를 인출 하는 것이 가장 좋습니다.

```
https://contoso.b2clogin.com/contoso.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_signupsignin1
```
이 URL에 있는 JSON 문서에는 특정 시점에서 사용 중인 공개 키 정보가 모두 포함되어 있습니다. 앱은 JWT 헤더에 `kid` 클레임을 사용하여 특정 토큰 서명에 사용된 JSON 문서의 공개 키를 선택할 수 있습니다. 그런 다음 올바른 공개 키와 표시된 알고리즘을 사용하여 서명 유효성 검사를 수행할 수 있습니다.

`contoso.onmicrosoft.com` 테넌트의 `B2C_1_signupsignin1` 정책에 대한 메타 데이터 문서는 다음 위치에 있습니다.

```
https://contoso.b2clogin.com/contoso.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_signupsignin1
```

토큰을 서명 하는 데 사용 된 정책 (및 메타 데이터를 요청 하기 위해 이동할 위치)을 결정 하기 위해 두 가지 옵션이 있습니다. 먼저 정책 이름은 토큰의 `acr` 클레임에 포함됩니다. base-64로 본문을 디코딩하고 결과 JSON 문자열을 역직렬화하여 JWT의 본문에서 클레임을 구문 분석할 수 있습니다. `acr` 클레임은 토큰을 발급 하는 데 사용 된 정책의 이름입니다. 다른 옵션은 요청을 실행할 때 `state` 매개 변수의 값에 정책을 인코딩한 다음이를 디코딩하여 사용 된 정책을 확인 하는 것입니다. 두 방법 중 하나는 유효합니다.

서명 유효성 검사를 수행하는 방법에 대한 설명은 이 문서의 범위를 벗어납니다. 토큰의 유효성을 검사 하는 데 도움이 되는 다양 한 오픈 소스 라이브러리가 제공 됩니다.

### <a name="validate-claims"></a>클레임 유효성 검사

응용 프로그램 또는 API가 ID 토큰을 받으면 ID 토큰의 클레임에 대해 여러 검사를 수행 해야 합니다. 다음 클레임을 확인 해야 합니다.

- **대상 그룹** -ID 토큰이 응용 프로그램에 제공 될 것이 맞는지 확인 합니다.
- **이전이 아님** 및 **만료 시간** -ID 토큰이 만료 되지 않았는지 확인 합니다.
- **issuer** -Azure AD B2C 여 응용 프로그램에 토큰이 발급 되었는지 확인 합니다.
- **nonce** -토큰 재생 공격 완화를 위한 전략입니다.

응용 프로그램에서 수행 해야 하는 유효성 검사의 전체 목록은 [Openid connect Connect 사양](https://openid.net)을 참조 하세요.

## <a name="next-steps"></a>다음 단계

[액세스 토큰을 사용하는 방법](access-tokens.md)에 대해 자세히 알아보세요.

