---
title: 응용 프로그램 게이트웨이의 작동 원리
description: 이 문서에서는 응용 프로그램 게이트웨이에서 들어오는 요청을 수락 하 고 백 엔드로 라우팅하는 방법에 대한 정보를 제공 합니다.
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 11/16/2019
ms.author: absha
ms.openlocfilehash: d9d7ae3bc321f1f000fac1a875589df352077f33
ms.sourcegitcommit: 2d3740e2670ff193f3e031c1e22dcd9e072d3ad9
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/16/2019
ms.locfileid: "74129814"
---
# <a name="how-an-application-gateway-works"></a>응용 프로그램 게이트웨이의 작동 원리

이 문서에서는 응용 프로그램 게이트웨이에서 들어오는 요청을 수락 하 고 백 엔드로 라우팅하는 방법을 설명 합니다.

![응용 프로그램 게이트웨이에서 요청을 수락 하는 방법](./media/how-application-gateway-works/how-application-gateway-works.png)

## <a name="how-an-application-gateway-accepts-a-request"></a>응용 프로그램 게이트웨이에서 요청을 수락 하는 방법

1. 클라이언트는 application gateway에 요청을 보내기 전에 DNS (Domain Name System) 서버를 사용 하 여 응용 프로그램 게이트웨이의 도메인 이름을 확인 합니다. 모든 응용 프로그램 게이트웨이가 azure.com 도메인에 있기 때문에 Azure는 DNS 항목을 제어 합니다.

2. Azure DNS은 클라이언트에 대한 IP 주소를 반환 합니다 .이 주소는 응용 프로그램 게이트웨이의 프런트 엔드 IP 주소입니다.

3. 응용 프로그램 게이트웨이는 하나 이상의 수신기에서 들어오는 트래픽을 허용 합니다. 수신기는 연결 요청을 확인 하는 논리적 엔터티입니다. 클라이언트에서 응용 프로그램 게이트웨이로의 연결을 위한 프런트 엔드 IP 주소, 프로토콜 및 포트 번호를 사용 하 여 구성 됩니다.

4. WAF (웹 응용 프로그램 방화벽)를 사용 중인 경우 application gateway는 요청 헤더와 본문 (있는 경우)을 WAF 규칙에 대해 확인 합니다. 이 작업은 요청이 유효한 요청 인지 아니면 보안 위협 인지를 결정 합니다. 요청이 올바르면 백 엔드로 라우팅됩니다. 요청이 유효 하지 않고 WAF가 방지 모드 이면 보안 위협으로 차단 됩니다. 검색 모드에 있는 경우 요청이 평가 되 고 기록 되지만 백엔드 서버로 전달 됩니다.

Azure 애플리케이션 게이트웨이를 내부 응용 프로그램 부하 분산 장치 또는 인터넷 연결 응용 프로그램 부하 분산 장치로 사용할 수 있습니다. 인터넷 연결 응용 프로그램 게이트웨이는 공용 IP 주소를 사용 합니다. 인터넷 연결 응용 프로그램 게이트웨이의 DNS 이름은 공용 IP 주소에 공개적으로 확인할 수 있습니다. 결과적으로 인터넷 연결 응용 프로그램 게이트웨이는 클라이언트 요청을 인터넷으로 라우팅할 수 있습니다.

내부 응용 프로그램 게이트웨이는 개인 IP 주소만 사용 합니다. 사용자 지정 또는 [사설 DNS 영역](https://docs.microsoft.com/azure/dns/private-dns-overview)을 사용 하는 경우 Application Gateway의 개인 IP 주소에서 도메인 이름을 내부적으로 확인할 수 있어야 합니다. 따라서 내부 부하 분산 장치는 응용 프로그램 게이트웨이에 대한 가상 네트워크에 대한 액세스 권한이 있는 클라이언트의 요청만 라우팅할 수 있습니다.

## <a name="how-an-application-gateway-routes-a-request"></a>응용 프로그램 게이트웨이에서 요청을 라우팅하는 방법

요청이 유효 하 고 WAF에 의해 차단 되지 않으면 응용 프로그램 게이트웨이는 수신기와 연결 된 요청 라우팅 규칙을 평가 합니다. 이 작업은 요청을 라우팅할 백 엔드 풀을 결정 합니다.

요청 라우팅 규칙에 따라 응용 프로그램 게이트웨이는 수신기의 모든 요청을 특정 백 엔드 풀로 라우팅하도록 할지 여부를 결정 하 고, URL 경로를 기반으로 하는 다른 백 엔드 풀에 요청을 라우트 하거나, 다른 포트나 외부 사이트에 대한 요청을 리디렉션합니다.
>[!NOTE]
>규칙은 v1 SKU에 대한 포털에 나열 된 순서 대로 처리 됩니다. 

응용 프로그램 게이트웨이는 백 엔드 풀을 선택할 때 풀 (x-y)의 정상 백 엔드 서버 중 하나로 요청을 보냅니다. 서버의 상태는 상태 프로브에 의해 결정 됩니다. 백 엔드 풀에 여러 서버가 포함 된 경우 응용 프로그램 게이트웨이는 라운드 로빈 알고리즘을 사용 하 여 정상 서버 간에 요청을 라우팅합니다. 이렇게 하면 서버에서 요청 부하가 분산 됩니다.

응용 프로그램 게이트웨이는 백 엔드 서버를 확인 한 후 HTTP 설정에 따라 백 엔드 서버를 사용 하 여 새 TCP 세션을 엽니다. HTTP 설정은 백 엔드 서버와의 새 세션을 설정 하는 데 필요한 프로토콜, 포트 및 기타 라우팅 관련 설정을 지정 합니다.

HTTP 설정에 사용 되는 포트 및 프로토콜에 따라 응용 프로그램 게이트웨이와 백 엔드 서버 간의 트래픽이 암호화 되는지 (종단 간 SSL 수행) 또는 암호화 되지 않습니다.

Application gateway는 백 엔드 서버에 원래 요청을 보내면 호스트 이름, 경로 및 프로토콜을 재정의 하는 것과 관련 된 HTTP 설정에서 사용자 지정 구성을 적용 합니다. 이 작업은 쿠키 기반 세션 선호도, 연결 드레이닝, 호스트 이름 선택이 백 엔드에서 유지 되도록 합니다.

 >[!NOTE]
>백 엔드 풀 인 경우:
> - **는 공용 엔드포인트입니다**. 응용 프로그램 게이트웨이는 프런트 엔드 공용 IP를 사용 하 여 서버에 연결 합니다. 프런트 엔드 공용 IP 주소가 없으면 아웃 바운드 외부 연결에 대해 하나가 할당 됩니다.
> - **내부적으로 확인할 수 있는 FQDN 또는 개인 ip 주소를 포함**하는 응용 프로그램 게이트웨이는 해당 인스턴스 개인 ip 주소를 사용 하 여 백 엔드 서버로 요청을 라우팅합니다.
> - **외부 엔드포인트 또는 외부적으로 확인할 수 있는 FQDN이 포함 되어 있습니다**. application gateway는 프런트 엔드 공용 IP 주소를 사용 하 여 백 엔드 서버로 요청을 라우팅합니다. DNS 확인은 개인 DNS 영역 또는 사용자 지정 DNS 서버 (구성 된 경우)를 기반으로 하며, Azure에서 제공 하는 기본 DNS를 사용 합니다. 프런트 엔드 공용 IP 주소가 없으면 아웃 바운드 외부 연결에 대해 하나가 할당 됩니다.

### <a name="modifications-to-the-request"></a>요청에 대한 수정

응용 프로그램 게이트웨이는 백 엔드에 요청을 전달 하기 전에 모든 요청에 4 개의 추가 헤더를 삽입 합니다. 이러한 헤더는 x로 전달 되며, x-전달 된 프로토콜, x-전달 된 포트 및 x-원본 호스트입니다. X로 전달 된 헤더의 형식은 쉼표로 구분 된 IP: port 목록입니다.

X 전달 프로토콜의 유효한 값은 HTTP 또는 HTTPS입니다. X 전달-포트는 요청이 application gateway에 도달 하는 포트를 지정 합니다. X 원본-호스트 헤더에는 요청이 도착 한 원래 호스트 헤더가 포함 됩니다. 이 헤더는 트래픽이 백 엔드로 라우팅되기 전에 들어오는 호스트 헤더가 수정 되는 Azure 웹 사이트 통합에 유용 합니다. 세션 선호도가 옵션으로 사용 하도록 설정 된 경우 게이트웨이 관리 선호도 쿠키를 추가 합니다.

[HTTP 헤더 재작성](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers) 을 사용 하 여 헤더를 수정 하거나 경로 재정의 설정을 사용 하 여 URI 경로를 수정 하도록 응용 프로그램 게이트웨이를 구성할 수 있습니다. 그러나이 작업을 수행 하도록 구성 되지 않은 경우 들어오는 모든 요청은 백 엔드에 프록시 됩니다.

## <a name="next-steps"></a>다음 단계

[Application gateway 구성 요소에 대한 자세한 정보](application-gateway-components.md)
