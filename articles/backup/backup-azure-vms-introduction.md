---
title: Azure VM 백업 정보
description: 이 문서에서는 Azure Backup 서비스에서 Azure VM을 백업하는 방법과 모범 사례를 따르는 방법에 대해 알아봅니다.
ms.topic: conceptual
ms.date: 09/13/2019
ms.openlocfilehash: 5ce76f64093bab362d62afcc3f94d07f7ee7883d
ms.sourcegitcommit: 79c9c95e8a267abc677c8f3272cb9d7f9673a3d7
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/19/2021
ms.locfileid: "107718452"
---
# <a name="an-overview-of-azure-vm-backup"></a>Azure VM 백업 개요

이 문서에서는 [Azure Backup 서비스](./backup-overview.md)가 Azure VM(가상 머신)을 백업하는 방법을 설명합니다.

Azure Backup은 VM에서 의도하지 않은 데이터 소멸을 방지하기 위해 독립적이고 격리된 백업을 제공합니다. 백업은 복구 지점의 기본 제공 관리 기능을 통해 Recovery Services 자격 증명 모음에 저장됩니다. 구성 및 스케일링은 간단하고, 백업은 최적화되며, 필요에 따라 쉽게 복원할 수 있습니다.

백업 프로세스의 일부로 [스냅샷이](#snapshot-creation)생성되며, 프로덕션 워크로드에 영향을 주지 않고 데이터를 Recovery Services 자격 증명 모음으로 전송합니다. 스냅샷은 [여기](#snapshot-consistency)에 설명된 대로 서로 다른 수준의 일관성을 제공합니다.

또한 Azure Backup은 워크로드를 인식하고, 15분 RPO(복구 지점 목표)를 제공하며, 개별 데이터베이스의 백업과 복원을 허용하는 [SQL Server](backup-azure-sql-database.md) 및 [SAP HANA](sap-hana-db-about.md)와 같은 데이터베이스 워크로드를 위한 전문 서비스를 제공합니다.

## <a name="backup-process"></a>백업 프로세스

다음은 Azure Backup이 Azure VM 백업을 완료하는 방법입니다.

[!INCLUDE [azure-vm-backup-process.md](../../includes/azure-vm-backup-process.md)]

## <a name="encryption-of-azure-vm-backups"></a>Azure VM 백업 암호화

Azure Backup을 사용하여 Azure VM을 백업하면 미사용 상태의 VM이 SSE(스토리지 서비스 암호화)를 사용하여 암호화됩니다. Azure Backup은 또한 Azure 디스크 암호화를 사용하여 암호화된 Azure VM을 백업할 수 있습니다.

**암호화** | **세부 정보** | **지원**
--- | --- | ---
**SSE** | SSE를 사용하여 Azure Storage는 데이터를 저장하기 전에 자동으로 암호화하여 미사용 상태의 암호화를 제공합니다. Azure Storage는 또한 데이터를 검색하기 전에 데이터의 암호를 해독합니다. Azure Backup은 두 가지 유형의 스토리지 서비스 암호화를 사용하는 VM의 백업을 지원합니다.<li> **플랫폼 관리형 키를 사용하는 SSE**: 이 암호화는 기본값으로 VM의 모든 디스크에 적용됩니다. [여기](../virtual-machines/disk-encryption.md#platform-managed-keys)에서 자세한 내용을 알아보세요.<li> **고객 관리형 키를 사용하는 SSE입니다**. CMK를 사용하여 디스크를 암호화하는 데 사용되는 키를 관리합니다. [여기](../virtual-machines/disk-encryption.md#customer-managed-keys)에서 자세한 내용을 알아보세요. | Azure Backup은 Azure VM의 미사용 상태의 암호화를 위해 SSE를 사용합니다.
**Azure 디스크 암호화** | Azure 디스크 암호화는 Azure VM의 OS 및 데이터 디스크를 모두 암호화합니다.<br/><br/> Azure 디스크 암호화는 키 자격 증명 모음에서 비밀로 보호되는 BEK(BitLocker 암호화 키)와 통합됩니다. Azure 디스크 암호화는 KEK(Azure Key Vault 키 암호화 키)와도 통합됩니다. | Azure Backup은 BEK만을 사용하거나 KEK와 BEK를 함께 사용하여 암호화된 관리형 및 비관리형 Azure VM의 백업을 지원합니다.<br/><br/> BEK와 KEK는 모두 백업 및 암호화됩니다.<br/><br/> KEK 및 BEK가 백업되기 때문에 필요한 권한이 있는 사용자는 필요한 경우 키와 비밀을 키 자격 증명 모음으로 다시 복원할 수 있습니다. 이러한 사용자는 암호화된 VM을 복구할 수도 있습니다.<br/><br/> 암호화된 키와 비밀은 권한 없는 사용자 또는 Azure에서 읽을 수 없습니다.

관리형 및 비관리형 Azure VM의 경우 BEK만을 사용하거나 암호화된 VM 및 KEK와 BEK를 함께 사용하여 암호화된 VM의 백업을 모두 지원합니다.

백업한 BEK(비밀) 및 KEK(키)가 암호화됩니다. 이러한 항목은 권한 있는 사용자가 키 자격 증명 모음으로 다시 복원할 때만 읽고 사용할 수 있습니다. 권한 없는 사용자나 Azure는 백업한 키나 비밀을 읽거나 사용할 수 없습니다.

BEK도 백업됩니다. 따라서 BEK가 손실되면 권한 있는 사용자가 BEK를 키 자격 증명 모음으로 복원하고 암호화된 VM을 복구할 수 있습니다. 필요한 수준의 사용 권한이 있는 사용자만 암호화된 VM 또는 키 및 비밀을 백업하고 복원할 수 있습니다.

## <a name="snapshot-creation"></a>스냅샷 만들기

Azure Backup은 백업 일정에 따라 스냅샷을 생성합니다.

- **Windows VM:** Windows VM의 경우 Backup 서비스가 VSS와 조정되어 VM 디스크의 일관성 있는 앱 스냅샷을 생성합니다.  기본값으로 Azure Backup은 전체 VSS 백업을 수행합니다. 백업 시 애플리케이션 수준의 일관된 백업 결과를 얻기 위해 SQL Server와 같은 애플리케이션의 로그를 자릅니다.  Azure VM 백업에 SQL Server 데이터베이스를 사용하는 경우 VSS 복사본 백업을 수행하는 설정을 수정하여 로그를 보존할 수 있습니다. 자세한 내용은 [이 문서](./backup-azure-vms-troubleshoot.md#troubleshoot-vm-snapshot-issues)를 참조하세요.

- **Linux VM:** Linux VM의 앱 일관성이 있는 스냅샷을 만들려면 Linux 사전 스크립트 및 사후 스크립트 프레임워크를 사용하여 일관성이 보장되도록 고유한 사용자 지정 스크립트를 작성합니다.

  - Azure Backup은 사용자가 작성한 사전/사후 스크립트만 호출합니다.
  - Azure Backup은 사전 스크립트 및 사후 스크립트가 성공적으로 실행되는 경우 애플리케이션 일관성으로 복구 지점을 표시합니다. 사용자 지정 스크립트를 사용하는 경우 애플리케이션 일관성에 대한 책임은 궁극적으로 사용자에게 있습니다.
  - 스크립트를 구성하는 방법에 대해 [자세히 알아봅니다](backup-azure-linux-app-consistent.md).

## <a name="snapshot-consistency"></a>스냅샷 일관성

다음 표에서는 여러 유형의 스냅샷 일관성에 대해 설명합니다.

**스냅샷** | **세부 정보** | **복구** | **고려 사항**
--- | --- | --- | ---
**애플리케이션 일관성** | 앱 일관성이 있는 백업은 메모리 콘텐츠 및 보류 중인 I/O 작업을 캡처합니다. 앱 일관성 스냅샷은 백업이 수행되기 전에 VSS 기록기(또는 Linux용 사전/사후 스크립트)를 사용하여 앱 데이터 일관성을 보장합니다. | 앱 일관성이 있는 스냅샷으로 VM을 복구하는 경우 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱이 일관성 있는 상태로 시작됩니다. | Windows: 모든 VSS 기록기가 성공함<br/><br/> Linux: 사전/사후 스크립트가 구성됨 및 성공함
**파일 시스템 일관성** | 파일 시스템 일관성 백업은 모든 파일의 스냅샷을 동시에 만들어 일관성을 제공합니다.<br/><br/> | 파일 시스템 일관성이 있는 스냅샷으로 VM을 복구하는 경우 VM이 부팅됩니다. 데이터 손상 또는 손실이 없습니다. 앱은 자체 “수정” 메커니즘을 구현하여 복원된 데이터가 일관성 있는지 확인해야 합니다. | Windows: 일부 VSS 기록기가 실패함 <br/><br/> Linux: 기본값(사전/사후 스크립트가 구성되지 않거나 실패하는 경우)
**크래시 일관성** | 크래시 일관성 스냅샷은 일반적으로 백업 시 Azure VM이 종료되는 경우에 발생합니다. 백업 시 디스크에 이미 존재하는 데이터만 캡처 및 백업됩니다. | VM 부팅 프로세스에서 시작하여 디스크 검사 후에 손상 오류를 수정합니다. 크래시 전에 디스크에 전송되지 않은 메모리 내 데이터 또는 쓰기 작업은 모두 손실됩니다. 앱이 고유한 데이터 확인을 구현합니다. 예를 들어 데이터베이스 앱은 확인을 위해 트랜잭션 로그를 사용할 수 있습니다. 트랜잭션 로그에 데이터베이스에 없는 항목이 있는 경우 데이터베이스 소프트웨어는 데이터가 일관성을 찾을 때가지 트랜잭션을 백합니다. | VM이 종료(중지/할당 취소) 상태입니다.

>[!NOTE]
> 프로비전 상태가 **성공** 인 경우 Azure Backup은 파일 시스템 일관성 백업을 수행합니다. 프로비전 상태를 **사용할 수 없거나** **실패** 한 경우 크래시 일관성 백업이 수행됩니다. 프로비전 상태를 **만들거나** **삭제** 하는 경우 Azure Backup 작업을 다시 시도하는 것을 의미합니다.

## <a name="backup-and-restore-considerations"></a>백업 및 복원 고려 사항

**고려 사항** | **세부 정보**
--- | ---
**디스크** | VM 디스크의 백업은 병렬로 진행됩니다. 예를 들어 VM에 4개의 디스크가 있는 경우 백업 서비스는 4개의 디스크를 모두 병렬로 백업하려고 합니다. 백업은 증분 방식입니다(변경된 데이터만 백업).
**일정 예약** |  백업 트래픽을 줄이려면 하루 중 다른 시간에 다른 VM을 백업하고 시간이 겹치지 않도록 해야 합니다. VM을 동시에 백업하면 트래픽 정체가 발생합니다.
**백업 준비** | 백업을 준비하는 데 필요한 시간을 염두에 두세요. 준비 시간에는 백업 확장을 설치 또는 업데이트하고 백업 일정에 따라 스냅샷을 트리거하는 작업이 포함됩니다.
**데이터 전송** | Azure Backup에서 이전 백업의 증분 변경 내용을 식별하는 데 필요한 시간을 고려합니다.<br/><br/> 증분 백업에서 Azure Backup은 블록의 체크섬을 계산하여 변경 내용을 확인합니다. 블록을 변경하는 경우 자격 증명 모음으로 전송하도록 표시됩니다. 서비스는 식별된 블록을 분석하여 전송할 데이터의 양을 더 최소화하려고 합니다. 변경된 모든 블록을 평가한 후에는 Azure Backup은 자격 증명 모음에 변경 내용을 전송합니다.<br/><br/> 스냅샷을 생성하는 시간과 자격 증명 모음으로 복사하는 시간 사이에 지연이 있을 수 있습니다. 사용량이 많은 시간에는 스냅 샷을 자격 증명 모음으로 전송하는 데 최대 8시간이 걸릴 수 있습니다. VM에 대한 백업 시간은 일별 백업의 경우 24시간 미만입니다.
**초기 백업** | 증분 백업의 총 백업 시간은 24시간 미만이지만 첫 번째 백업은 그렇지 않을 수 있습니다. 초기 백업에 필요한 시간은 데이터의 크기 및 백업이 처리되는 시간에 따라 달라집니다.
**복원 큐** | Azure Backup이 동시에 여러 스토리지 계정의 복원을 처리하므로 복원 요청을 큐에 배치합니다.
**복원 복사** | 복원 프로세스 동안 데이터가 자격 증명 모음에서 스토리지 계정으로 복사됩니다.<br/><br/> 총 복원 시간은 IOPS(초당 I/O 작업 수) 및 스토리지 계정의 처리량에 따라 달라집니다.<br/><br/> 복사 시간을 단축하려면 다른 애플리케이션 쓰기 및 읽기로 로드되지 않은 스토리지 계정을 선택합니다.

### <a name="backup-performance"></a>Backup 성능

다음과 같은 일반적인 시나리오는 총 백업 시간에 영향을 줄 수 있습니다.

- **보호된 Azure VM에 새 디스크 추가:** VM이 증분 백업을 수행하고 새 디스크를 추가하면 백업 시간이 늘어납니다. 기존 디스크의 델타 복제와 함께 새 디스크의 초기 복제로 인해 총 백업 시간은 24시간 넘게 지속될 수 있습니다.
- **분산된 디스크:** 백업 작업은 디스크 변경이 연속적일 때 더 빠릅니다. 변경 내용이 디스크 전체에 분산되고 조각화되면 백업이 더 느려집니다.
- **디스크 변동:** 증분 백업 중인 보호된 디스크에 200GB가 넘는 일일 변동이 있는 경우 백업을 완료하는 데 긴 시간(8시간 초과)이 걸릴 수 있습니다.
- **백업 버전:** 최신 버전의 Backup(즉시 복원 버전이라고 함)은 변경 내용을 식별하기 위한 체크섬 비교보다 좀 더 최적화된 프로세스를 사용합니다. 하지만 인스턴트 복원을 사용 중이고 백업 스냅샷을 삭제한 경우 백업은 체크섬 비교로 전환됩니다. 이 경우 백업 작업은 24시간을 초과하거나 실패합니다.

### <a name="restore-performance"></a>복원 성능

다음과 같은 일반적인 시나리오는 총 복원 시간에 영향을 줄 수 있습니다.

- 총 복원 시간은 IOPS(초당 입/출력 작업 수) 및 스토리지 계정의 처리량에 따라 달라집니다.
- 대상 스토리지 계정이 다른 애플리케이션 읽기 및 쓰기 작업과 함께 로드되는 경우 총 복원 시간이 영향을 받을 수 있습니다. 복원 작업을 향상시키려면 다른 애플리케이션 데이터와 함께 로드되지 않는 스토리지 계정을 선택합니다.

## <a name="best-practices"></a>모범 사례

VM 백업을 구성할 때 다음 사례를 따르는 것이 좋습니다.

- 정책에 설정된 기본 예약 시간을 수정합니다. 예를 들어 정책의 기본 시간이 오전 12시인 경우 리소스가 최적으로 사용되도록 몇 분 정도 시간을 늘립니다.
- 단일 자격 증명 모음에서 VM을 복원하는 경우에는 다른 [범용 v2 스토리지 계정](../storage/common/storage-account-upgrade.md)을 사용하여 대상 스토리지 계정이 제한되지 않도록 하는 것이 좋습니다. 예를 들어 각 VM에는 다른 스토리지 계정이 있어야 합니다. 예를 들어 10개의 VM을 복원하는 경우 10개의 서로 다른 스토리지 계정을 사용합니다.
- 즉시 복원으로 Premium Storage를 사용하는 VM 백업의 경우 할당된 총 스토리지 공간의 *50%* 를 사용 가능한 공간으로 할당하는 것이 좋습니다. 이는 첫 번째 백업에서 **만** 필요합니다. 첫 번째 백업이 완료된 후에는 백업에 50%의 사용 가능한 공간이 필요하지 않습니다.
- 스토리지 계정당 디스크 수 제한은 IaaS(서비스 제공 인프라) VM에서 실행되는 애플리케이션에서 디스크에 액세스하는 수준과 관련되어 있습니다. 일반적으로 단일 스토리지 계정에 디스크가 5~10개 이상 있으면 일부 디스크를 별도의 스토리지 계정으로 이동하여 부하를 분산합니다.
- PowerShell을 사용하여 관리 디스크를 사용하는 VM을 복원하려면 추가 매개 변수 ***TargetResourceGroupName*** 을 제공하여 관리되는 디스크를 복원할 리소스 그룹을 지정합니다. [여기에서 자세히 알아보세요](./backup-azure-vms-automation.md#restore-managed-disks).

## <a name="backup-costs"></a>백업 비용

Azure Backup으로 백업된 Azure VM에는 [Azure Backup 가격 책정](https://azure.microsoft.com/pricing/details/backup/)이 적용됩니다.

요금 청구는 첫 번째 백업이 성공적으로 완료되기 전까지 시작되지 않습니다. 이때 스토리지와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다. VM의 백업 데이터가 자격 증명 모음에 저장되어 있는 한, 요금이 계속 청구됩니다. VM에 대한 보호를 중지하지만, 자격 증명 모음에 VM에 대한 백업 데이터가 있는 경우 요금은 계속 청구됩니다.

지정된 VM에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다. 보호가 중지되고 활성 백업 작업이 없으면 마지막으로 성공한 VM 백업이 월별 청구에 사용되는 보호된 인스턴스 크기가 됩니다.

보호된 인스턴스 크기 계산은 VM의 *실제* 크기를 기반으로 합니다. VM의 크기는 임시 스토리지를 제외하고 VM에 있는 모든 데이터의 합계입니다. 가격 책정은 VM에 연결된 각 데이터 디스크에 대해 지원되는 최대 크기가 아니라 데이터 디스크에 저장된 실제 데이터를 기반으로 합니다.

마찬가지로, 백업 스토리지 요금은 Azure Backup을 사용하여 저장된 데이터 양(각 복구 지점의 실제 데이터 합계)을 기준으로 청구됩니다.

최대 크기가 각각 32TB인 두 개의 추가 데이터 디스크가 있는 A2 표준 크기 VM을 예로 들 수 있습니다. 다음 표는 각 디스크에 저장된 실제 데이터를 보여줍니다.

**디스크** | **최대 크기** | **표시되는 실제 데이터**
--- | --- | ---
OS 디스크 | 32TB | 17GB
로컬/임시 디스크 | 135GB | 5GB(백업에 포함되지 않음)
데이터 디스크 1 | 32TB| 30GB
데이터 디스크 2 | 32TB | 0GB

이 경우 VM의 실제 크기는 17GB+30GB+0GB=47GB입니다. 이 보호된 인스턴스 크기(47GB)는 월별 청구서의 근거가 됩니다. VM의 데이터 양이 증가하면 요금 청구에 사용되는 보호된 인스턴스 크기도 그에 맞춰 변경됩니다.

## <a name="next-steps"></a>다음 단계

- [Azure VM 백업을 준비합니다.](backup-azure-arm-vms-prepare.md)