---
title: Anomaly Detector 다변량 API 사용 모범 사례
titleSuffix: Azure Cognitive Services
description: Anomaly Detector 다변량 API를 사용하여 시계열 데이터에 변칙 검색을 적용하는 모범 사례입니다.
services: cognitive-services
author: mrbullwinkle
manager: nitinme
ms.service: cognitive-services
ms.subservice: anomaly-detector
ms.topic: conceptual
ms.date: 04/01/2021
ms.author: mbullwin
keywords: 변칙 검색, 기계 학습, 알고리즘
ms.openlocfilehash: 30778cf48efda57fc0d50964611d5616ce7a84d5
ms.sourcegitcommit: 17345cc21e7b14e3e31cbf920f191875bf3c5914
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/19/2021
ms.locfileid: "110062257"
---
# <a name="multivariate-time-series-anomaly-detector-best-practices"></a>다변량 시계열 Anomaly Detector 모범 사례

이 문서에서는 다변량 Anomaly Detector API를 사용할 때 따라야 하는 권장 사례에 관한 지침을 제공합니다.

## <a name="training-data"></a>학습 데이터 

### <a name="data-schema"></a>데이터 스키마
Anomaly Detector 다변량 API를 사용하려면 먼저 고유한 모델을 학습해야 합니다. 학습 데이터는 다음 요구 사항을 충족하는 여러 시계열 세트입니다.

각 시계열은 헤더 행으로 **"timestamp"** 및 **"value"** (모두 소문자)라는 2개(및 2개만)의 열이 포함된 CSV 파일이어야 합니다. "timestamp" 값은 ISO 8601을 준수해야 합니다. "value"는 소수 자릿수가 있는 정수 또는 소수일 수 있습니다. 예를 들면 다음과 같습니다.

|timestamp | 값|
|-------|-------|
|2019-04-01T00:00:00Z| 5|
|2019-04-01T00:01:00Z| 3.6|
|2019-04-01T00:02:00Z| 4|
|`...`| `...` |

각 CSV 파일의 이름을 모델 학습에 사용되는 다른 변수 뒤에 지정해야 합니다. 예를 들면 "temperature.csv" 및 "humidity.csv"입니다. 모든 CSV 파일은 하위 폴더 없이 하나의 zip 파일로 압축되어야 합니다. zip 파일에는 원하는 이름을 사용할 수 있습니다. zip 파일을 Azure Blob Storage에 업로드해야 합니다. zip 파일에 대한 [Blob SAS(공유 액세스 서명) URL](../../../storage/common/storage-sas-overview.md)을 생성한 후에는 학습에 사용할 수 있습니다. Azure Blob Storage에서 SAS URL을 생성하는 방법은 이 문서를 참조하세요.

### <a name="data-quality"></a>데이터 품질
- 모델이 기록 데이터에서 정상 패턴을 학습할 때 학습 데이터는 **시스템의 전체적인 정상 상태를 나타내야 합니다**. 학습 데이터가 변칙으로 가득 찬 경우 모델은 이 유형의 패턴을 학습하기 어렵습니다. 
-  모델에는 수백만 개의 매개 변수가 있으며 최적 매개 변수 세트를 학습하려면 최소 개수의 데이터 요소가 필요합니다. 일반적으로 모델을 제대로 학습시키려면 **변수당 15,000개 이상의 데이터 요소** 를 제공해야 합니다. 데이터가 많을수록 모델이 향상됩니다.
- 일반적으로 **학습 데이터의 누락된 값 비율은 20% 미만** 이어야 합니다. 누락된 데이터가 너무 많으면 자동으로 채워진 값(일반적으로 직선 세그먼트 또는 상수 값)이 일반 패턴으로 학습될 수 있습니다. 이로 인해 실제 데이터 요소가 비정상으로 감지될 수 있습니다. 

    그러나 높은 비율이 허용될 수 있는 경우가 있습니다. 예를 들어 `Outer` 모드를 사용하여 타임스탬프를 정렬하는 두 개의 시계열이 그룹에 있는 경우입니다. 하나는 1분 단위로 세분화되어 있고 다른 하나는 시간 단위로 세분화되어 있습니다. 그러면 기본적으로 시간별 시계열에는 최소 59/60 = 98.33%의 누락 데이터 요소가 있습니다. 이러한 경우 일반적으로 너무 많이 변동하지 않는 경우에만 사용 가능한 값을 사용하여 시간별 시계열을 채워야 합니다.

## <a name="parameters"></a>매개 변수

### <a name="sliding-window"></a>슬라이딩 윈도우

다변량 변칙 검색은 `slidingWindow` 길이의 데이터 요소 세그먼트를 입력으로 사용하고 다음 데이터 요소가 변칙인지 결정합니다. 샘플 길이가 클수록 결정을 위해 더 많은 데이터가 고려됩니다. `slidingWindow`에 대해 적절한 값을 선택할 때 고려해야 할 두 가지 항목은 입력 데이터의 속성 및 학습/유추 시간과 잠재적인 성능 향상 간 절충입니다. `slidingWindow`는 28~2880 사이 정수로 구성됩니다. 데이터가 주기적인지 여부 및 데이터의 샘플링 비율에 따라 입력으로 사용되는 데이터 요소 수를 결정할 수 있습니다.

데이터가 주기적인 경우 1~3개 주기를 입력으로 포함할 수 있는 경우와 분 수준 또는 초 수준 데이터 같은 높은 빈도(작은 세분성)로 데이터를 샘플링하는 경우에는 더 많은 데이터를 입력으로 선택할 수 있습니다. 또 다른 문제는 입력이 길어지면 학습/유추 시간이 길어질 수 있는 문제가 있으며 입력 지점 증가가 성능 향상을 보장하는 것은 아닙니다. 반면, 데이터 요소가 너무 적으면 모델이 최적 솔루션으로 수렴되기 어려울 수 있습니다. 예를 들어, 입력 데이터에 두 개의 지점만 있는 경우 변칙을 검색하기 어렵습니다.

### <a name="align-mode"></a>정렬 모드

`alignMode` 매개 변수는 타임스탬프에서 여러 시계열을 정렬하는 방법을 지정하는 데 사용됩니다. 이는 많은 시계열에 누락 값이 있고 추가 처리 전에 동일한 타임스탬프에서 해당 시계열을 정렬해야 하기 때문입니다. 이 매개 변수에는 `inner join` 및 `outer join`의 두 가지 옵션이 있습니다. `inner join`은 **모든 시계열** 에 값이 있는 타임스탬프의 검색 결과를 보고하지만, `outer join`은 값이 있는 **시계열** 에 대한 타임스탬프의 검색 결과를 보고합니다.  **`alignMode`는 모델의 입력 시퀀스에도 영향을 주므로**, 결과가 크게 다를 수 있기 때문에 시나리오에 적합한 `alignMode`를 선택합니다.

여기에서는 다양한 `alignModel` 값을 설명하는 예제를 보여 줍니다.

#### <a name="series1"></a>Series1

|timestamp | 값|
----------| -----|
|`2020-11-01`| 1  
|`2020-11-02`| 2  
|`2020-11-04`| 4  
|`2020-11-05`| 5

#### <a name="series2"></a>Series2

timestamp | 값  
--------- | -
`2020-11-01`| 1  
`2020-11-02`| 2  
`2020-11-03`| 3  
`2020-11-04`| 4

#### <a name="inner-join-two-series"></a>두 계열 내부 조인
  
timestamp | Series1 | Series2
----------| - | -
`2020-11-01`| 1 | 1
`2020-11-02`| 2 | 2
`2020-11-04`| 4 | 4

#### <a name="outer-join-two-series"></a>두 계열 외부 조인

timestamp | series1 | series2
--------- | - | -
`2020-11-01`| 1 | 1
`2020-11-02`| 2 | 2
`2020-11-03`| 해당 없음 | 3
`2020-11-04`| 4 | 4
`2020-11-05`| 5 | 해당 없음

### <a name="fill-not-available-na"></a>NA(해당 없음) 채우기

외부 조인으로 타임스탬프에서 변수를 정렬한 후 일부 변수에 `Not Available`(`NA`) 값이 있을 수 있습니다. 이 NA 값을 채우는 메서드를 지정할 수 있습니다. `fillNAMethod`의 옵션은 `Linear`, `Previous`, `Subsequent`,  `Zero`, `Fixed`입니다.

| 옵션     | 메서드                                                                                           |
| ---------- | -------------------------------------------------------------------------------------------------|
| 선형     | 선형 보간으로 NA 값 채우기                                                           |
| 이전   | 마지막 유효한 값을 전파하여 간격을 채웁니다. 예제: `[1, 2, nan, 3, nan, 4]` -> `[1, 2, 2, 3, 3, 4]` |
| 후속 | 다음 유효한 값을 사용하여 간격을 채웁니다. 예제: `[1, 2, nan, 3, nan, 4]` -> `[1, 2, 3, 3, 4, 4]`       |
| 0       | NA 값을 0으로 채웁니다.                                                                           |
| 고정      | `paddingValue`에 제공되어야 하는 지정된 유효한 값으로 NA 값을 채웁니다.          |

## <a name="model-analysis"></a>모델 분석

### <a name="training-latency"></a>학습 대기 시간

다변량 변칙 검색 학습은 시간이 많이 걸릴 수 있습니다. 특히 학습에 사용된 타임스탬프가 많은 경우에 시간이 많이 걸립니다. 따라서 학습 프로세스의 일부는 비동기적일 수 있습니다. 일반적으로 사용자는 모델 학습 API를 통해 학습 작업을 제출합니다. 그런 다음, `Get Multivariate Model API`를 통해 모델 상태를 가져옵니다. 여기서는 학습이 완료되기 전에 남은 시간을 추출하는 방법을 보여 줍니다. 다변량 모델 가져오기 API 응답에는 `diagnosticsInfo`라는 항목이 있습니다. 이 항목에는 `modelState` 요소가 있습니다. 남은 시간을 계산하려면 `epochIds` 및 `latenciesInSeconds`를 사용해야 합니다. Epoch는 학습 데이터를 통해 하나의 전체 주기를 나타냅니다. 10개 epoch마다 상태 정보를 출력합니다. 총 100개 epoch에 대해 학습하고 대기 시간은 epoch에 걸리는 시간을 나타냅니다. 이 정보를 사용하여 모델 학습에 남은 시간을 알 수 있습니다.

### <a name="model-performance"></a>모델 성능

감독되지 않는 모델로서 다변량 변칙 검색입니다. 이를 평가하는 가장 좋은 방법은 변칙 결과를 수동으로 확인하는 것입니다. 다변량 모델 가져오기 응답에서 모델 성능을 분석하기 위한 몇 가지 기본 정보를 제공합니다. 다변량 모델 가져오기 API에서 반환된 `modelState` 요소에서 `trainLosses` 및 `validationLosses`를 사용하여 모델이 예상대로 학습되었는지 평가합니다. 대부분의 경우 두 가지 손실은 점점 감소합니다. 모델 성능을 분석하기 위한 또 다른 정보는 `variableStates`에 있습니다. 변수 상태 목록은 `filledNARatio`를 기준으로 내림차순으로 정렬됩니다. 성능이 더 저하될수록 일반적으로 이 `NA ratio`를 최대한 많이 줄여야 합니다. `NA`는 누락된 값 또는 타임스탬프 관점의 정렬되지 않은 변수로 인해 발생할 수 있습니다.

## <a name="next-steps"></a>다음 단계

- [빠른 시작](../quickstarts/client-libraries-multivariate.md).
- [Anomaly Detector 다변량을 지원하는 기본 알고리즘에 관해 알아보기](https://arxiv.org/abs/2009.02040)
