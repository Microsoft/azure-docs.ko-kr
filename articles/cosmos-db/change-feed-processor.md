---
title: Azure Cosmos DB에서 변경 피드 프로세서 라이브러리 사용
description: Azure Cosmos DB 변경 피드 프로세서 라이브러리 사용.
author: rimman
ms.service: cosmos-db
ms.devlang: dotnet
ms.topic: conceptual
ms.date: 11/06/2018
ms.author: rimman
ms.reviewer: sngun
ms.openlocfilehash: cf03233c6a92b7fd1b782f8128787bfda5582f7d
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "60893337"
---
# <a name="change-feed-processor-in-azure-cosmos-db"></a>Azure Cosmos DB의 변경 피드 프로세서 

[Azure Cosmos DB 변경 피드 프로세서 라이브러리](sql-api-sdk-dotnet-changefeed.md)는 여러 소비자 사이에 이벤트 처리를 쉽게 배포하는 데 유용합니다. 이 라이브러리는 파티션 및 병렬 작동하는 여러 스레드 사이에서 변경 사항 읽기를 간소화합니다.

변경 피드 프로세서 라이브러리의 주요 이점은 각 파티션 및 연속 토큰을 관리하지 않아도 되며 각 컨테이너를 수동으로 폴링하지 않아도 된다는 점입니다.

이 변경 피드 프로세서 라이브러리는 파티션 및 병렬 작동하는 여러 스레드 사이에서 변경 사항 읽기를 간소화합니다. 이 라이브러리는 임대 메커니즘을 사용하여 파티션 사이에서 변경 사항 읽기를 자동으로 관리합니다. 다음 그림과 같이 변경 피드 프로세서 라이브러리를 사용하는 두 클라이언트를 시작하는 경우 두 클라이언트가 둘 사이에서 작업을 분할합니다. 계속해서 클라이언트 수를 늘리면 계속해서 클라이언트 사이에서 작업을 분할합니다.

![Azure Cosmos DB 변경 피드 프로세서 라이브러리 사용](./media/change-feed-processor/change-feed-output.png)

왼쪽 클라이언트가 가장 먼저 시작되었고 모든 파티션의 모니터링을 시작한 다음 두 번째 클라이언트가 시작되었고 첫 번째 클라이언트는 두 번째 클라이언트에 일부 임대를 해제합니다. 그래서 다른 머신 및 클라이언트 간에 작업을 배포하는 것이 효율적인 방법입니다.

동일한 컨테이너를 모니터링하고 동일한 임대를 사용하는 두 서버리스 Azure 함수가 있는 경우 이 두 함수는 프로세스 라이브러리가 파티션 처리 방식을 어떻게 결정하는가에 따라 다른 문서를 가져올 수 있습니다.

## <a name="implementing-the-change-feed-processor-library"></a>변경 피드 프로세서 라이브러리 구현

변경 피드 프로세서 라이브러리를 구현하는 주요 구성 요소 4개는 다음과 같습니다. 

1. **모니터링된 컨테이너:** 모니터링된 컨테이너에는 변경 피드가 생성되는 데이터가 있습니다. 모니터링된 컨테이너에 대한 모든 삽입 및 변경 내용은 컨테이너의 변경 피드에 반영됩니다.

1. **임대 컨테이너:** 임대 컨테이너는 여러 작업자 사이에서 변경 피드의 처리를 조정합니다. 개별 컨테이너를 사용하여 임대를 저장합니다(파티션당 하나의 임대). 변경 피드 프로세서를 실행하는 곳과 근접한 쓰기 영역을 사용하여 다른 계정에 이 임대 컨테이너를 저장하는 것이 유용합니다. 임대 개체에는 다음 특성이 포함됩니다.

   * 소유자: 임대를 소유하는 호스트를 지정합니다.

   * 연속: 특정 파티션에 대한 변경 피드에서의 위치(연속 토큰)를 지정합니다.

   * 타임스탬프: 마지막으로 임대가 업데이트된 시간입니다. 타임스탬프를 사용하여 임대가 만료된 것으로 간주되는지 여부를 확인할 수 있습니다.

1. **프로세서 호스트:** 각 호스트는 활성 임대가 포함된 호스트의 다른 인스턴스 수에 따라 처리할 파티션 수를 결정합니다.

   * 호스트가 시작되면 임대를 획득하여 모든 호스트에서 워크로드를 분산합니다. 호스트는 임대가 활성 상태로 유지되도록 주기적으로 임대를 갱신합니다.

   * 호스트는 읽기를 수행할 때마다 해당 임대에 대한 가장 최근 연속 토큰의 검사점을 설정합니다. 동시성 안전을 보장하기 위해 호스트는 각 임대 업데이트에 대한 ETag를 확인합니다. 다른 검사점 전략도 지원됩니다.

   * 종료 시 호스트는 모든 임대를 해제하지만 나중에 저장된 검사점에서 읽기를 다시 시작할 수 있도록 연속 정보를 유지합니다.

   현재 호스트 수는 파티션(임대) 수보다 클 수 없습니다.

1. **소비자:** 소비자나 작업자는 각 호스트에서 시작된 변경 피드 처리를 수행하는 스레드입니다. 각 프로세서 호스트에는 여러 소비자가 있을 수 있습니다. 각 소비자는 할당된 파티션에서 변경 피드를 읽고 호스트에게 변경 사항 및 만료된 임대를 알려줍니다.

변경 피드 프로세서의 이러한 4개의 요소가 상호 작용하는 방법을 이해하기 위해 다음 다이어그램의 예제를 살펴보겠습니다. 모니터링된 컬렉션은 문서를 저장하고 파티션 키로 "City"를 사용합니다. 파란색 파티션에는 "A-E"의 "City" 필드가 있는 문서가 포함되었다고 표시됩니다. 두 호스트에는 동시에 4개의 파티션을 읽는 두 명의 소비자가 있습니다. 화살표는 소비자가 읽는 변경 피드의 특정 지점을 표시합니다. 첫 번째 파티션에서 어두운 파란색은 변경 피드의 아직 읽지 않은 변경 내용을 나타내는 반면, 연한 파란색은 이미 읽은 변경 내용을 나타냅니다. 호스트는 임대 컬렉션을 사용하여 "continuation" 값을 저장하고, 이로써 각 소비자의 현재 읽기 위치를 추적할 수 있습니다.

![변경 피드 프로세서 예제](./media/change-feed-processor/changefeedprocessor.png)

### <a name="change-feed-and-provisioned-throughput"></a>변경 피드 및 프로비전된 처리량

Cosmos 컨테이너 내부 및 외부의 데이터 이동은 항상 RU를 사용하므로 사용된 RU 요금이 청구됩니다. 임대 컨테이너에서 사용되는 RU 요금이 청구됩니다.

## <a name="additional-resources"></a>추가 리소스

* [Azure Cosmos DB 변경 피드 프로세서 라이브러리](sql-api-sdk-dotnet-changefeed.md)
* [NugGet 패키지](https://www.nuget.org/packages/Microsoft.Azure.DocumentDB.ChangeFeedProcessor/)
* [GitHub의 추가 샘플](https://github.com/Azure/azure-documentdb-dotnet/tree/master/samples/ChangeFeedProcessor)

## <a name="next-steps"></a>다음 단계

이제 다음 문서에서 변경 피드에 대해 자세히 알아볼 수 있습니다.

* [변경 피드 개요](change-feed.md)
* [변경 피드를 읽는 방법](read-change-feed.md)
* [Azure Functions로 변경 피드 사용](change-feed-functions.md)
