---
title: '자습서: 백 엔드 풀에 둘 이상의 가용성 집합이 있는 부하 분산 장치 만들기 - Azure Portal'
titleSuffix: Azure Load Balancer
description: 이 자습서에서는 백 엔드 풀에 둘 이상의 가용성 집합이 있는 Azure Load Balancer를 배포합니다.
author: asudbring
ms.author: allensu
ms.service: load-balancer
ms.topic: tutorial
ms.date: 04/21/2021
ms.custom: template-tutorial
ms.openlocfilehash: 71115da01f47572d77243f25204d5b1127db22cd
ms.sourcegitcommit: 5ce88326f2b02fda54dad05df94cf0b440da284b
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/22/2021
ms.locfileid: "107887165"
---
# <a name="tutorial-create-a-load-balancer-with-more-than-one-availability-set-in-the-backend-pool-using-the-azure-portal"></a>자습서: Azure Portal을 사용하여 백 엔드 풀에 둘 이상의 가용성 집합이 있는 부하 분산 장치 만들기

고가용성 배포의 일부로 가상 머신은 대개 여러 가용성 집합으로 그룹화됩니다. 

Load Balancer는 백 엔드 풀에 가상 머신이 있는 가용성 집합을 둘 이상 지원합니다.

이 자습서에서는 다음 작업 방법을 알아봅니다.

> [!div class="checklist"]
> * 가상 네트워크 만들기
> * 아웃바운드 연결에 대한 NAT 게이트웨이 만들기
> * 표준 SKU Azure Load Balancer 만들기
> * 네 개의 가상 머신과 두 개의 가용성 집합 만들기
> * 부하 분산 장치의 백 엔드 풀에 가용성 집합의 가상 머신 추가
> * 부하 분산 장치 테스트

## <a name="prerequisites"></a>필수 구성 요소

- 활성 구독이 있는 Azure 계정. [체험 계정을 만듭니다](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

## <a name="create-a-virtual-network"></a>가상 네트워크 만들기

이 섹션에서는 부하 분산 장치와 자습서에서 사용되는 다른 리소스에 대한 가상 네트워크를 만듭니다.

1. [Azure Portal](https://portal.azure.com)에 로그인합니다.

2. 포털 맨 위에 있는 검색 상자에 **가상 네트워크** 를 입력합니다.

3. 검색 결과에서 **가상 네트워크** 를 선택합니다.

4. **+ 만들기** 를 선택합니다.

5. **가상 네트워크 만들기** 의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ------|
    | **프로젝트 세부 정보** |   |
    | Subscription | 구독을 선택합니다. |
    | Resource group | **새로 만들기** 를 선택합니다. </br> **이름** 에 **TutorLBmultiAVS-rg** 를 입력합니다. |
    | **인스턴스 세부 정보** |   |
    | 속성 | **myVNet** 을 입력합니다. |
    | 지역 | **미국 서부 2** 를 선택합니다. |

6. **IP 주소** 탭 또는 페이지 하단의 **다음: IP 주소** 단추를 선택합니다.

7. **IP 주소** 탭의 **서브넷 이름** 에서 **기본값** 을 선택합니다.

8. **서브넷 편집** 창의 **서브넷 이름** 에서 **myBackendSubnet** 을 입력합니다.

9. **저장** 을 선택합니다.

10. **보안** 탭 또는 페이지 하단에 있는 **다음: 보안** 단추를 선택합니다.

11. **보안** 탭의 **BastionHost** 에서 **사용** 을 선택합니다.

12. 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | Bastion 이름 | **MyBastionHost** 를 입력합니다. |
    | AzureBastionSubnet 주소 공간 | **10.1.1.0/27** 을 입력합니다. |
    | 공용 IP 주소 | **새로 만들기** 를 선택합니다. </br> **이름** 에 **myBastionIP** 를 입력합니다. |

13. **검토 + 만들기** 탭 또는 페이지 아래쪽에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

14. **만들기** 를 선택합니다.

## <a name="create-nat-gateway"></a>NAT 게이트웨이 만들기 

이 섹션에서는 가상 머신의 아웃바운드 연결에 대한 NAT 게이트웨이를 만듭니다.

1. 포털 맨 위에 있는 검색 상자에 **NAT 게이트웨이** 를 입력합니다.

2. 검색 결과에서 **NAT 게이트웨이** 를 선택합니다.

3. **+ 만들기** 를 선택합니다.

4. **NAT(Network Address Translation) 게이트웨이 만들기** 의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | **프로젝트 세부 정보** |   |
    | Subscription | 구독을 선택합니다. |
    | Resource group | **TutorLBmultiAVS-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |   |
    | NAT 게이트웨이 이름 | **myNATgateway** 를 입력합니다. |
    | 지역 | **미국 서부 2** 를 선택합니다. |
    | 가용성 영역 | **없음** 을 선택합니다. |
    | 유휴 제한 시간(분) | **15** 를 입력합니다. |

5. **아웃바운드 IP** 탭을 선택하거나 페이지 하단에 있는 **다음: 아웃바운드 IP** 단추를 선택합니다.

6. **아웃바운드 IP** 탭에서 **공용 IP 주소** 옆에 있는 **새 공용 IP 주소 만들기** 를 선택합니다.

7. **이름** 에 **myPublicIP-nat** 를 입력합니다.

8. **확인** 을 선택합니다.

9. **서브넷** 탭을 선택하거나 페이지 하단에 있는 **다음: 서브넷** 단추를 선택합니다.

10. 풀 다운 메뉴의 **가상 네트워크** 에서 **myVNet** 을 선택합니다.

11. **myBackendSubnet** 옆의 확인란을 선택합니다.

12. **검토 + 만들기** 탭을 선택하거나 페이지 하단에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

13. **만들기** 를 선택합니다.

## <a name="create-load-balancer"></a>부하 분산 장치 만들기

이 섹션에서는 가상 머신에 대한 부하 분산 장치를 만듭니다.

1. 포털 맨 위에 있는 검색 상자에 **부하 분산 장치** 를 입력합니다.

2. 검색 결과에서 **부하 분산 장치** 를 선택합니다.

3. **+ 만들기** 를 선택합니다.

4. **부하 분산 장치 만들기** 페이지의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | **프로젝트 세부 정보** |   |
    | Subscription | 구독을 선택합니다. |
    | Resource group | **TutorLBmultiAVS-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |   |
    | 속성 | **myLoadBalancer** 를 입력합니다. |
    | 지역 | **미국 서부 2** 를 선택합니다. |
    | Type | **공용**(기본값)을 그대로 둡니다. |
    | SKU | 기본값인 **표준** 을 그대로 둡니다. |
    | 계층 | **지역**(기본값)을 그대로 둡니다. |
    | **공용 IP 주소** |   |
    | 공용 IP 주소 | **새로 만들기**(기본값)를 그대로 둡니다. |
    | 공용 IP 주소 이름 | **myPublicIP-lb** 를 입력합니다. |
    | 가용성 영역 | **영역 중복** 을 선택합니다. |
    | 공용 IPv6 주소 추가 | **아니요**(기본값)를 그대로 둡니다. |
    | 라우팅 기본 설정 | **Microsoft 네트워크** 의 기본값을 그대로 둡니다. |

5. **검토 + 만들기** 탭을 선택하거나 페이지 하단에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

6. **만들기** 를 선택합니다.

### <a name="configure-load-balancer-settings"></a>부하 분산 장치 설정 구성

이 섹션에서는 **myLoadBalancer** 에 대한 백 엔드 풀을 만듭니다.

**HTTP** 및 **포트 80** 을 모니터링하는 상태 프로브를 만듭니다. 상태 프로브는 백 엔드 풀에 있는 가상 머신의 상태를 모니터링합니다. 

아웃바운드 SNAT를 사용하지 않도록 설정하여 **포트 80** 에 대한 부하 분산 규칙을 만듭니다. 앞에서 만든 NAT 게이트웨이가 가상 머신의 아웃바운드 연결을 처리합니다.

1. 포털 맨 위에 있는 검색 상자에 **부하 분산 장치** 를 입력합니다.

2. 검색 결과에서 **부하 분산 장치** 를 선택합니다.

3. **myLoadBalancer** 를 선택합니다.

4. **myLoadBalancer** 의 **설정** 에서 **백 엔드 풀** 을 선택합니다.

5. **백 엔드 풀** 에서 **+ 추가** 를 선택합니다.

6. **백 엔드 풀 추가** 에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | 이름 | **myBackendPool** 을 입력합니다. |
    | 가상 네트워크 | **myVNet** 을 선택합니다. |
    | 백 엔드 풀 구성 | **NIC**(기본값)를 그대로 둡니다. |
    | IP 버전 | **IPv4**(기본값)를 그대로 둡니다. |

7. **추가** 를 선택합니다.

8. **상태 프로브** 를 선택합니다.

9. **+추가** 를 선택합니다.

10. **상태 프로브 추가** 에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | 속성 | **myHTTPProbe** 를 입력합니다. |
    | 프로토콜 | **HTTP** 를 선택합니다. |
    | 포트 | **80**(기본값)을 그대로 둡니다. |
    | 경로 | **/** (기본값)를 그대로 둡니다. |
    | 간격 | **5** 초(기본값)를 그대로 둡니다. |
    | 비정상 임계값 | **2** 회 연속 실패(기본값)를 그대로 둡니다. |

11. **추가** 를 선택합니다.

12. **부하 분산 규칙** 을 선택합니다. 

13. **+추가** 를 선택합니다.

14. **부하 분산 장치 규칙** 에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | 속성 | **myHTTPRule** 을 입력합니다. |
    | IP 버전 | **IPv4**(기본값)를 그대로 둡니다. |
    | 프런트 엔드 IP 주소 | **LoadBalancerFrontEnd** 를 선택합니다. |
    | 프로토콜 | **TCP**(기본값)를 선택합니다. |
    | 포트 | **80** 을 입력합니다. |
    | 백 엔드 포트 | **80** 을 입력합니다. |
    | 백 엔드 풀 | **myBackendPool** 을 선택합니다. |
    | 상태 프로브 | **myHTTPProbe** 를 선택합니다. |
    | 세션 지속성 | **없음** 의 기본값을 그대로 둡니다. |
    | 유휴 제한 시간(분) | 슬라이더를 **15** 로 변경합니다. |
    | TCP 재설정 | **사용** 을 선택합니다. |
    | 부동 IP | **사용 안 함**(기본값)을 그대로 둡니다. |
    | 아웃바운드 SNAT(Source Network Address Translation) | **(권장) 아웃바운드 규칙을 사용하여 백 엔드 풀 멤버에 인터넷 액세스 권한을 제공합니다.** (기본값)를 그대로 둡니다. |

5. **추가** 를 선택합니다.

## <a name="create-virtual-machines"></a>가상 머신 만들기

이 섹션에서는 그룹당 두 개의 가상 머신을 사용하여 두 개의 가용성 그룹을 만듭니다. 이러한 컴퓨터는 생성 중에 부하 분산 장치의 백 엔드 풀에 추가됩니다. 

### <a name="create-first-set-of-vms"></a>첫 번째 VM 집합 만들기

1. 포털의 왼쪽 위 섹션에서 **+ 리소스 만들기** 를 선택합니다.

2. **새로 만들기** 에서 **컴퓨팅**  >  **가상 머신** 을 선택합니다.

3. **가상 머신 만들기** 페이지의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | **프로젝트 세부 정보** |   |
    | 구독 | 구독 선택 |
    | 리소스 그룹 | **TutorLBmultiAVS-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |   |
    | 가상 머신 이름 | **myVM1** 을 입력합니다. |
    | 지역 | **미국 서부 2** 를 선택합니다. |
    | 가용성 옵션 | **가용성 집합** 을 선택합니다. |
    | 가용성 집합 | **새로 만들기** 를 선택합니다. </br> **이름** 에서 **myAvailabilitySet1** 을 입력합니다. </br> **확인** 을 선택합니다. |
    | 이미지 | **Windows Server 2019 Datacenter - Gen1** 을 선택합니다. |
    | Azure Spot 인스턴스 | 선택 안 함(기본값)을 그대로 둡니다. |
    | 크기 | 가상 머신의 크기를 선택합니다. |
    | **관리자 계정** |   |
    | 사용자 이름 | 사용자 이름을 입력합니다. |
    | 암호 | 암호를 입력합니다. |
    | **인바운드 포트 규칙** |   |
    | 공용 인바운드 포트 | **없음** 을 선택합니다. |

4. **네트워킹** 탭을 선택하거나 페이지 하단에 있는 **다음: 디스크** 를 선택한 다음, **다음: 네트워킹** 단추를 선택합니다.

5. **네트워킹** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | **네트워크 인터페이스** |   |
    | 가상 네트워크 | **myVNet** 을 선택합니다. |
    | 서브넷 | **myBackendSubnet** 을 선택합니다. |
    | 공용 IP | **없음** 을 선택합니다. |
    | NIC 네트워크 보안 그룹 추가 | **고급** 을 선택합니다. |
    | 네트워크 보안 그룹 구성 | **새로 만들기** 를 선택합니다. </br> **이름** 에 **myNSG** 를 입력합니다. </br> **인바운드 규칙** 에서 **+인바운드 규칙 추가** 를 선택합니다. </br> **서비스** 에 대해 **HTTP** 를 선택합니다. </br> **이름** 에 대해 **myHTTPrule** 을 입력합니다. </br> **추가** 를 선택합니다. </br> **확인** 을 선택합니다. | 
    | **부하 분산**. |   |
    | 기존 부하 분산 솔루션 뒤에 이 가상 머신을 배치하시겠습니까? | 확인란을 선택합니다. |
    | **부하 분산 설정** |   |
    | 부하 분산 옵션 | **Azure Load Balancer** 를 선택합니다. |
    | 부하 분산 장치 선택 | **myLoadBalancer** 를 선택합니다. |
    | 백 엔드 풀 선택 | **myBackendPool** 을 선택합니다. |

6. **검토 + 만들기** 탭을 선택하거나 페이지 하단에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

7. **만들기** 를 선택합니다.

8. 1~7단계를 반복하여 집합의 두 번째 가상 머신을 만듭니다. VM에 대한 설정을 다음 정보로 바꿉니다.

    | 설정 | 값 |
    | ------- | ----- |
    | 속성 | **myVM2** 를 입력합니다. |
    | 가용성 집합 | **myAvailabilitySet1** 을 선택합니다. |
    | Virtual Network | **myVNet** 을 선택합니다. |
    | 서브넷 | **myBackendSubnet** 을 선택합니다. |
    | 공용 IP | **없음** 을 선택합니다. |
    | 네트워크 보안 그룹 | **myNSG** 를 선택합니다. |
    | 부하 분산 옵션 | **Azure Load Balancer** 를 선택합니다. |
    | 부하 분산 장치 선택 | **myLoadBalancer** 를 선택합니다. |
    | 백 엔드 풀 선택 | **myBackendPool** 을 선택합니다. |

### <a name="create-second-set-of-vms"></a>두 번째 VM 집합 만들기

1. 포털의 왼쪽 위 섹션에서 **+ 리소스 만들기** 를 선택합니다.

2. **새로 만들기** 에서 **컴퓨팅**  >  **가상 머신** 을 선택합니다.

3. **가상 머신 만들기** 페이지의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | **프로젝트 세부 정보** |   |
    | 구독 | 구독 선택 |
    | 리소스 그룹 | **TutorLBmultiAVS-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |   |
    | 가상 머신 이름 | **myVM3** 를 입력합니다. |
    | 지역 | **미국 서부 2** 를 선택합니다. |
    | 가용성 옵션 | **가용성 집합** 을 선택합니다. |
    | 가용성 집합 | **새로 만들기** 를 선택합니다. </br> **이름** 에서 **myAvailabilitySet2** 를 입력합니다. </br> **확인** 을 선택합니다. |
    | 이미지 | **Windows Server 2019 Datacenter - Gen1** 을 선택합니다. |
    | Azure Spot 인스턴스 | 선택 안 함(기본값)을 그대로 둡니다. |
    | 크기 | 가상 머신의 크기를 선택합니다. |
    | **관리자 계정** |   |
    | 사용자 이름 | 사용자 이름을 입력합니다. |
    | 암호 | 암호를 입력합니다. |
    | **인바운드 포트 규칙** |   |
    | 공용 인바운드 포트 | **없음** 을 선택합니다. |

4. **네트워킹** 탭을 선택하거나 페이지 하단에 있는 **다음: 디스크** 를 선택한 다음, **다음: 네트워킹** 단추를 선택합니다.

5. **네트워킹** 탭에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | **네트워크 인터페이스** |   |
    | 가상 네트워크 | **myVNet** 을 선택합니다. |
    | 서브넷 | **myBackendSubnet** 을 선택합니다. |
    | 공용 IP | **없음** 을 선택합니다. |
    | NIC 네트워크 보안 그룹 추가 | **고급** 을 선택합니다. |
    | 네트워크 보안 그룹 구성 | **myNSG** 를 선택합니다. | 
    | **부하 분산**. |   |
    | 기존 부하 분산 솔루션 뒤에 이 가상 머신을 배치하시겠습니까? | 확인란을 선택합니다. |
    | **부하 분산 설정** |   |
    | 부하 분산 옵션 | **Azure Load Balancer** 를 선택합니다. |
    | 부하 분산 장치 선택 | **myLoadBalancer** 를 선택합니다. |
    | 백 엔드 풀 선택 | **myBackendPool** 을 선택합니다. |

6. **검토 + 만들기** 탭을 선택하거나 페이지 하단에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

7. **만들기** 를 선택합니다.

8. 1~7단계를 반복하여 집합의 두 번째 가상 머신을 만듭니다. VM에 대한 설정을 다음 정보로 바꿉니다.

    | 설정 | 값 |
    | ------- | ----- |
    | 속성 | **myVM4** 를 입력합니다. |
    | 가용성 집합 | **myAvailabilitySet2** 를 선택합니다. |
    | Virtual Network | **myVNet** 을 선택합니다. |
    | 네트워크 보안 그룹 | **myNSG** 를 선택합니다. |
    | 부하 분산 옵션 | **Azure Load Balancer** 를 선택합니다. |
    | 부하 분산 장치 선택 | **myLoadBalancer** 를 선택합니다. |
    | 백 엔드 풀 선택 | **myBackendPool** 을 선택합니다. |

## <a name="install-iis"></a>IIS 설치

이 섹션에서는 이전에 만든 Azure Bastion 호스트를 사용하여 가상 머신에 연결하고 IIS를 설치합니다.

1. 포털 맨 위에 있는 검색 상자에 **가상 머신** 을 입력합니다.

2. 검색 결과에서 **가상 머신** 을 선택합니다.

3. **myVM1** 을 선택합니다.

4. myVM1의 **개요** 페이지에서 **연결** > **Bastion** 을 선택합니다.

5. **Bastion 사용** 을 선택합니다.

6. 가상 머신을 만들 때 만든 **사용자 이름** 및 **암호** 를 입력합니다.

7. **연결** 을 선택합니다.

7. 서버 바탕 화면에서 **Windows 관리 도구** > **Windows PowerShell** 로 이동합니다.

8. PowerShell 창에서 아래 명령을 실행하여 다음을 수행합니다.

    * IIS 서버를 설치합니다.
    * 기본 iisstart.htm 파일을 제거합니다.
    * VM 이름을 표시하는 새 iisstart.htm 파일을 추가합니다.

   ```powershell
    # Install IIS server role
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    
    # Remove default htm file
    Remove-Item  C:\inetpub\wwwroot\iisstart.htm
    
    # Add a new htm file that displays server name
    Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
   ```
8. **myVM1** 이 포함된 Bastion 세션을 닫습니다.

9. **myVM2**, **myVM3**, **myVM4** 에 대해 1~8 단계를 반복합니다.

## <a name="test-the-load-balancer"></a>부하 분산 장치 테스트

이 섹션에서는 부하 분산 장치의 공용 IP 주소를 검색합니다. IP 주소를 사용하여 부하 분산 장치의 작업을 테스트합니다.

1. 포털 맨 위에 있는 검색 상자에 **공용 IP** 를 입력합니다.

2. 검색 결과에서 **공용 IP 주소** 를 선택합니다.

3. **myPublicIP-lb** 를 선택합니다.

4. **myPublicIP-lb** 의 **개요** 페이지에 있는 **IP 주소** 에 나열된 공용 IP 주소를 확인합니다.

    :::image type="content" source="./media/tutorial-multi-availability-sets-portal/find-public-ip.png" alt-text="부하 분산 장치의 공용 IP 주소를 찾습니다." border="true":::

5. 웹 브라우저를 열고 주소 표시줄에 공용 IP 주소를 입력합니다.

    :::image type="content" source="./media/tutorial-multi-availability-sets-portal/verify-load-balancer.png" alt-text="웹 브라우저를 사용하여 부하 분산 장치를 테스트합니다." border="true":::

6. 브라우저에서 새로 고침을 선택하여 백 엔드 풀의 다른 가상 머신에 분산된 트래픽을 확인합니다.

## <a name="clean-up-resources"></a>리소스 정리

이 애플리케이션을 계속 사용할 계획이 없으면 다음 단계에 따라 부하 분산 장치 및 지원 리소스를 삭제합니다.

1. 포털 맨 위에 있는 검색 상자에 **리소스 그룹** 을 입력합니다.

2. 검색 결과에서 **리소스 그룹** 을 선택합니다.

3. **TutorLBmultiAVS-rg** 를 선택합니다.

4. **TutorLBmultiAVS-rg** 의 개요 페이지에서 **리소스 그룹 삭제** 를 선택합니다.

5. **리소스 그룹 이름 입력** 에 **TutorLBmultiAVS-rg** 를 입력합니다.

6. **삭제** 를 선택합니다.

## <a name="next-steps"></a>다음 단계

이 자습서에서는 다음을 수행합니다.

* 가상 네트워크 및 Azure Bastion 호스트를 만들었습니다.
* Azure 표준 Load Balancer를 만들었습니다.
* 집합마다 두 개의 가상 머신이 있는 두 개의 가용성 집합을 만들었습니다.
* IIS를 설치하고 부하 분산 장치를 테스트했습니다.

지역 간 Azure Load Balancer를 만드는 방법을 알아보려면 다음 문서로 계속 진행하세요.
> [!div class="nextstepaction"]
> [지역 간 부하 분산 장치 만들기](tutorial-cross-region-portal.md)

