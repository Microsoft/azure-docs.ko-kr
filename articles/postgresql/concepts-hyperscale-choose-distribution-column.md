---
title: 배포 열 선택-Hyperscale (Citus)-Azure Database for PostgreSQL
description: Azure Database for PostgreSQL의 일반적인 하이퍼 확장 시나리오에서 배포 열을 선택 하는 방법에 대해 알아봅니다.
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: 8ced9767d81affceef851820ee587f4f3dd24deb
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 12/10/2019
ms.locfileid: "74975672"
---
# <a name="choose-distribution-columns-in-azure-database-for-postgresql--hyperscale-citus"></a>Azure Database for PostgreSQL-Hyperscale (Citus)에서 배포 열 선택

각 테이블의 배포 열을 선택 하는 것은 가장 중요 한 모델링 결정 중 하나입니다. Azure Database for PostgreSQL – Hyperscale (Citus)은 행의 분포 열 값을 기준으로 분할에 행을 저장 합니다.

적절 한 선택은 같은 실제 노드에서 관련 데이터를 함께 그룹화 하 여 쿼리를 빠르게 수행 하 고 모든 SQL 기능에 대 한 지원을 추가 합니다. 잘못 된 항목을 선택 하면 시스템이 느리게 실행 되 고 노드에서 모든 SQL 기능을 지원 하지 않습니다.

이 문서에서는 가장 일반적인 두 가지 Citus (Hyperscale) 시나리오에 대 한 배포 열 팁을 제공 합니다.

### <a name="multi-tenant-apps"></a>다중 테넌트 앱

다중 테넌트 아키텍처는 서버 그룹의 노드 간에 쿼리를 분산하기 위해 계층적인 데이터베이스 모델링의 형태를 사용합니다. 데이터 계층의 맨 위를 *테넌트 ID* 라고 하며 각 테이블의 열에 저장 해야 합니다.

Citus (hyperscale)는 쿼리를 검사 하 여 관련 된 테넌트 ID를 확인 하 고 일치 하는 테이블 분할 된 테이블을 찾습니다. 분할을 포함하는 단일 작업자 노드로 쿼리를 라우팅합니다. 같은 노드에 있는 모든 관련 데이터를 사용하여 쿼리를 실행하는 것을 공동 배치라고 합니다.

다음 다이어그램에서는 다중 테넌트 데이터 모델에서의 공동 배치를 보여줍니다. Accounts 및 Campaigns 두 개의 테이블을 포함하며, 각각 `account_id`로 분산됩니다. 음영 처리 된 상자는 분할를 나타냅니다. 녹색 분할는 하나의 작업자 노드에 함께 저장 되 고, blue 분할는 다른 작업자 노드에 저장 됩니다. 두 테이블이 동일한 계정\_id로 제한 되는 경우 계정 및 캠페인 간 조인 쿼리는 하나의 노드에서 필요한 모든 데이터를 포함 하는 방법을 확인 합니다.

![다중 테넌트 공동 배치](media/concepts-hyperscale-choosing-distribution-column/multi-tenant-colocation.png)

사용자 고유의 스키마에서 이 디자인을 적용하려면 응용 프로그램에서 테넌트 구성 요소를 식별합니다. 일반적인 인스턴스는 회사, 계정, 조직 또는 고객을 포함합니다. 열 이름은 `company_id` 또는 `customer_id`와 같이 표시됩니다. 동일한 테넌트 ID를 사용 하 여 행과 관련 된 모든 테이블을 제한 하는 추가 WHERE 절이 있는 경우 각 쿼리를 검사 하 고 사용자에 게 문의 합니다.
다중 테넌트 모델의 쿼리 범위는 테넌트로 지정 됩니다. 예를 들어 판매 또는 인벤토리에 대 한 쿼리는 특정 저장소 내에서 범위가 지정 됩니다.

#### <a name="best-practices"></a>모범 사례

-   **공통 tenant\_id 열로 분산된 테이블을 파티션합니다.** 예를 들어 테넌트가 회사인 SaaS 응용 프로그램에서 테넌트\_id는 회사\_id 일 수 있습니다.
-   **작은 테넌트 간 테이블을 참조 테이블로 변환합니다.** 여러 테넌트가 작은 테이블의 정보를 공유하는 경우 참조 테이블로 분산합니다.
-   **tenant\_id로 모든 응용 프로그램 쿼리를 필터하여 제한합니다.** 각 쿼리는 한 번에 하나의 테넌트에 대한 정보를 요청해야 합니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대 한 예제는 [다중 테넌트 자습서](./tutorial-design-database-hyperscale-multi-tenant.md) 를 참조 하세요.

### <a name="real-time-apps"></a>실시간 앱

다중 테넌트 아키텍처는 계층 구조를 도입하고 테넌트별로 쿼리를 라우팅하도록 데이터 공동 배치를 사용합니다. 반면, 실시간 아키텍처는 높은 병렬 처리를 위해 해당 데이터의 특정 분산 속성에 따라 달라 집니다.

실시간 모델에서 분산 열에 대한 용어로 "엔터티 ID"를 사용합니다. 일반적인 엔터티는 사용자, 호스트 또는 장치입니다.

실시간 쿼리는 일반적으로 날짜 또는 범주별으로 그룹화하는 숫자 집계를 요청합니다. Citus (hyperscale)는 이러한 쿼리를 각 분할 된 부분 결과에 대해 전송 하 고 코디네이터 노드에 최종 답변을 어셈블합니다. 쿼리는 최대한 많은 노드가 참여하고 불균형한 양의 작업을 수행하는 단일 노드가 없는 경우 가장 빠르게 실행됩니다.

#### <a name="best-practices"></a>모범 사례

-   **분산 열로 카디널리티가 높은 열을 선택합니다.** 비교를 위해 새 값, 유료 및 배송 값을 포함 하는 주문 테이블의 상태 필드는 배포 열을 선택 하는 데 적합 하지 않습니다. 이 경우 데이터를 보유할 수 있는 분할 수와 처리할 수 있는 노드의 수를 제한하는 몇 가지 값만을 가정합니다. 카디널리티가 높은 열 중에는 group by 절에 자주 사용 되거나 조인 키로 자주 사용 되는 열을 선택 하는 것도 좋습니다.
-   **균등한 분산의 열을 선택합니다.** 특정 공통 값에 맞게 열에 테이블을 배포 하는 경우 테이블의 데이터는 특정 분할 누적 되는 경향이 있습니다. 이러한 분할를 보유 하는 노드는 다른 노드 보다 더 많은 작업을 수행 합니다.
-   **공통 열 기준으로 팩트 테이블과 차원 테이블을 분산합니다.**
    팩트 테이블은 하나의 분산 키만 있을 수 있습니다. 다른 키에 조인 되는 테이블은 팩트 테이블에 공동 배치 되지 않습니다. 조인 되는 빈도 및 조인 하는 행의 크기에 따라 공동 배치할 차원을 하나 선택 합니다.
-   **일부 차원 테이블을 참조 테이블로 변경합니다.** 팩트 테이블과 차원 테이블을 공동 배치 수 없는 경우에는 차원 테이블의 복사본을 참조 테이블 형식의 모든 노드에 분산 하 여 쿼리 성능을 향상 시킬 수 있습니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대 한 예제는 [실시간 대시보드 자습서](./tutorial-design-database-hyperscale-realtime.md) 를 참조 하세요.

### <a name="time-series-data"></a>시계열 데이터

시계열 작업에서 응용 프로그램은 이전 정보를 보관 하는 동안 최근 정보를 쿼리 합니다.

Citus (Hyperscale)에서 시계열 정보를 모델링 하는 가장 일반적인 실수는 타임 스탬프 자체를 배포 열로 사용 하는 것입니다. 시간 분배 시간을 기반으로 하는 해시 분포는 분할에서 시간 범위를 함께 유지 하는 대신 다양 한 분할에 임의로 보입니다. 시간을 포함 하는 쿼리는 일반적으로 가장 최근 데이터와 같은 시간 범위를 참조 합니다. 이러한 종류의 해시 배포는 네트워크 오버 헤드를 초래 합니다.

#### <a name="best-practices"></a>모범 사례

-   **배포 열로 타임 스탬프를 선택 하지 마세요.** 다른 배포 열을 선택합니다. 다중 테넌트 앱에서 테넌트 ID를 사용하거나 실시간 앱에서 엔터티 ID를 사용합니다.
-   **시간 대신 PostgreSQL 테이블 파티셔닝을 사용합니다.** 테이블 분할을 사용 하 여 다양 한 시간 범위를 포함 하는 각 테이블에 대해 많은 시간 정렬 된 데이터 테이블을 여러 개의 상속 된 테이블로 나눌 수 있습니다. Citus (Hyperscale)에서 Postgres-분할 된 테이블을 배포 하면 상속 된 테이블에 대 한 분할가 만들어집니다.

이러한 종류의 응용 프로그램을 빌드하는 방법에 대 한 예제는 [시계열 자습서](https://aka.ms/hyperscale-tutorial-timeseries) 를 참조 하세요.

## <a name="next-steps"></a>다음 단계
- 분산 데이터 간의 [공동 위치가](concepts-hyperscale-colocation.md) 쿼리를 빠르게 실행 하는 방법을 알아봅니다.
