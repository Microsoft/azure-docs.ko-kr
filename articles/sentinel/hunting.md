---
title: Azure Sentinel의 헌팅 기능 | Microsoft Docs
description: Azure Sentinel의 기본 제공 헌팅 쿼리를 사용하여 데이터에서 문제를 찾을 수 있는 적절한 질문을 안내합니다.
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: 6aa9dd27-6506-49c5-8e97-cc1aebecee87
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.custom: mvc
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/10/2019
ms.author: yelevin
ms.openlocfilehash: b88185a09e69b1c7bd6c6c58b8e22190b4a2e394
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/29/2021
ms.locfileid: "100576766"
---
# <a name="hunt-for-threats-with-azure-sentinel"></a>Azure Sentinel을 사용하여 위협 헌팅

보안 위협에 대한 사전 예방을 위해 조사를 할 경우 Azure Sentinel은 강력한 헌팅 검색 및 쿼리 도구를 통해 조직의 데이터 원본에서 보안 위협을 헌팅합니다. 그러나 시스템 및 보안 어플라이언스는 의미 있는 이벤트를 구문 분석하고 필터링하기 어려울 수 있는 데이터의 산을 생성합니다. 보안 분석가가 보안 앱에서 검색되지 않은 새 변칙을 사전에 확인하는 데 도움이 되도록 Azure Sentinel의 기본 제공 헌팅 쿼리는 네트워크에 이미 있는 데이터의 문제를 찾기 위한 적절한 질문을 안내합니다. 

예를 들어 기본 제공 쿼리 중 하나는 인프라에서 실행되는 가장 일반적인 프로세스에 대한 데이터를 제공합니다. 실행될 때마다 경고를 표시하지 않는 것이 좋습니다. 그러지 않은 경우에는 의도하지 않은 조건이 있는지 확인하기 위해 쿼리를 살펴볼 수 있습니다. 



Azure Sentinel 헌팅을 사용하면 다음과 같은 기능을 활용할 수 있습니다.

- 기본 제공 쿼리: 시작하기 위해 시작 페이지는 미리 로드된 쿼리 예제를 시작하여 테이블 및 쿼리 언어를 친숙하게 만들어서 시작할 수 있도록 설계되었습니다. 해당 기본 제공 헌팅 쿼리는 지속적으로 Microsoft 보안 연구원에 의해 개발되고, 새 쿼리를 추가하고, 기존 쿼리를 미세 조정하여 새 검색을 찾고 새 공격의 개시에 대한 헌팅을 시작할 위치를 파악할 수 있는 진입점을 제공합니다. 

- IntelliSense를 사용하는 강력한 쿼리 언어: 다음 헌팅 수준으로 이동하는 데 필요한 유연성을 제공하는 쿼리 언어 위에 빌드됩니다.

- 고유한 책갈피 만들기: 헌팅 프로세스 중에 비정상적이거나 의심스러워 보이는 일치 항목이나 발견 항목, 대시보드 또는 작업이 표시될 수 있습니다. 나중에 다시 확인하도록 해당 항목을 표시하기 위해 책갈피 기능을 사용합니다. 책갈피를 사용하여 나중에 조사를 위해 인시던트를 만드는 데 사용할 항목을 저장할 수 있습니다. 책갈피에 대한 자세한 내용은 [헌팅에 책갈피 사용](hunting.md)을 참조하세요.
- Notebook을 사용하여 조사 자동화: Notebook은 조사 및 헌팅 단계를 안내하기 위해 빌드할 수 있는 단계별 플레이북과 비슷합니다.  Notebook은 조직의 다른 사용자와 공유할 수 있는 재사용 가능한 플레이북의 모든 헌팅 단계를 캡슐화합니다. 
- 저장된 데이터 쿼리: 쿼리를 위해 테이블에서 데이터에 액세스할 수 있습니다. 예를 들어 프로세스 만들기, DNS 이벤트 및 기타 많은 이벤트 유형을 쿼리할 수 있습니다.

- 커뮤니티에 대한 링크: 더 큰 커뮤니티의 기능을 활용하여 추가 쿼리 및 데이터 원본을 찾을 수 있습니다.
 
## <a name="get-started-hunting"></a>헌팅 시작

1. Azure Sentinel 포털에서 **헌팅** 을 클릭합니다.
  ![Azure Sentinel에서 헌팅 시작](media/tutorial-hunting/hunting-start.png)

2. **헌팅** 페이지를 열면 모든 헌팅 쿼리가 단일 테이블에 표시됩니다. 이 표에는 Microsoft의 보안 분석가 팀에서 작성하거나 수정한 모든 추가 쿼리를 비롯한 모든 쿼리가 나열됩니다. 각 쿼리는 헌팅하는 것에 대한 설명 및 실행되는 데이터의 종류를 제공합니다. 해당 템플릿은 다양한 전략에 따라 그룹화됩니다. 오른쪽의 아이콘은 초기 액세스, 지속성, 반출 등의 위협 유형을 분류합니다. 모든 필드를 사용하여 해당 헌팅 쿼리 템플릿을 필터링할 수 있습니다. 모든 쿼리를 즐겨찾기에 저장할 수 있습니다. 즐겨찾기에 쿼리를 저장하면 자동으로 **헌팅** 페이지가 액세스될 때마다 쿼리가 자동으로 실행됩니다. 사용자 고유의 헌팅 쿼리를 만들거나 기존 헌팅 쿼리 템플릿을 복제하고 사용자 지정할 수 있습니다. 
 
2. 헌팅 쿼리 세부 정보 페이지에서 **쿼리 실행** 을 클릭하여 헌팅 페이지를 떠나지 않고 쿼리를 실행합니다.  일치하는 항목 수는 테이블 내에 표시됩니다. 헌팅 쿼리 및 일치 항목의 목록을 검토합니다. 일치 항목을 연결하는 킬 체인의 단계를 확인합니다.

3. 쿼리 세부 정보 창에서 기본 쿼리를 빠르게 검토하거나 **쿼리 결과 보기** 를 클릭하여 Log Analytics에서 쿼리를 엽니다. 아래쪽에서 쿼리와 일치하는 항목을 검토합니다.

4.    행을 클릭하고 **책갈피 추가** 를 선택하여 조사할 행을 추가합니다. 의심스러운 모든 항목에 대해 이 작업을 수행할 수 있습니다. 

5. 그리고 메인 **헌팅** 페이지로 돌아가 **책갈피** 탭을 클릭하여 의심스러운 활동을 모두 표시합니다. 

6. 책갈피를 선택하고 **조사** 를 클릭하여 조사 환경을 엽니다. 책갈피를 필터링할 수 있습니다. 예를 들어 캠페인을 조사하는 경우 캠페인에 대한 태그를 만든 다음 캠페인에 따라 모든 책갈피를 필터링할 수 있습니다.

1. 가능한 공격에 대한 수준 높은 인사이트를 제공하는 헌팅 쿼리를 발견한 후에는 쿼리를 기준으로 사용자 지정 검색 규칙을 만들고, 해당 인사이트를 보안 인시던트 응답자에게 경고로 제공할 수도 있습니다.

 

## <a name="query-language"></a>쿼리 언어 

Azure Sentinel의 헌팅은 Kusto 쿼리 언어를 기반으로 합니다. 쿼리 언어 및 지원되는 연산자에 대한 자세한 내용은 [쿼리 언어 참조](../azure-monitor/logs/get-started-queries.md)를 참조하세요.

## <a name="public-hunting-query-github-repository"></a>퍼블릭 헌팅 쿼리 GitHub 리포지토리

[헌팅 쿼리 리포지토리](https://github.com/Azure/Orion)를 확인합니다. 고객이 공유하는 예제 쿼리에 참여하고 해당 쿼리를 사용합니다.

 

## <a name="sample-query"></a>샘플 쿼리

일반적인 쿼리는 테이블 이름으로 시작하며 그 뒤에 로 구분된 일련의 \|연산자가 있습니다.

위의 예제에서 필요에 따라 테이블 이름 SecurityEvent로 시작하고 파이프된 요소를 추가합니다.

1. 이전 7일 동안의 레코드만을 검토하는 시간 필터를 정의합니다.

2. 이벤트 ID 4688만 표시하도록 쿼리에 필터를 추가합니다.

3. cscript.exe 인스턴스만 포함하는 명령줄의 쿼리에 필터를 추가합니다.

4. 검색하려는 열만 프로젝션하고 결과를 1000으로 제한한 다음 **쿼리 실행** 을 클릭합니다.
5. 녹색 삼각형을 클릭하고 쿼리를 실행합니다. 쿼리를 테스트하고 실행하여 비정상적인 동작을 찾을 수 있습니다.

## <a name="useful-operators"></a>유용한 연산자

쿼리 언어는 강력하고 사용할 수 있는 연산자가 많지만 여기에는 몇 가지 유용한 연산자가 나와 있습니다.

**where** - 조건자를 충족하는 행의 하위 집합으로 테이블을 필터링합니다.

**summarize** - 입력 테이블의 콘텐츠를 집계하는 테이블을 생성합니다.

**join** - 두 테이블의 행을 병합하여 각 테이블에서 지정된 열의 값을 일치시키는 방식으로 새 테이블을 만듭니다.

**count** - 입력 레코드 집합의 레코드 수를 반환합니다.

**top** - 지정한 열을 기준으로 정렬된 처음 N개 레코드를 반환합니다.

**limit** - 최대 지정된 수의 행을 반환합니다.

**project** - 포함하거나, 이름을 바꾸거나 또는 삭제할 열을 선택하고 새로운 컴퓨팅된 열을 삽입합니다.

**extend** - 계산된 열을 만들고 결과 집합에 추가합니다.

**makeset** - 해당 그룹에서 가져오는 고유 값 집합의 동적(JSON) 배열을 반환합니다.

**find** - 테이블 집합 사이에서 조건자와 일치하는 행을 찾습니다.

## <a name="save-a-query"></a>쿼리 저장

쿼리를 만들거나 수정하고 사용자의 쿼리로 저장하거나 동일한 테넌트에 있는 사용자와 공유할 수 있습니다.

   ![쿼리 저장](./media/tutorial-hunting/save-query.png)

새 헌팅 쿼리 만들기:

1. **새 쿼리** 를 클릭하고 **저장** 을 선택합니다.
2. 모든 빈 필드를 채우고 **저장** 을 선택합니다.

   ![새 쿼리](./media/tutorial-hunting/new-query.png)

기존 헌팅 쿼리를 복제하고 수정합니다.

1. 수정하려는 테이블에서 헌팅 쿼리를 선택합니다.
2. 수정하려는 쿼리 줄에서 줄임표(...)를 선택하고 **쿼리 복제** 를 선택합니다.

   ![쿼리 복제](./media/tutorial-hunting/clone-query.png)
 

3. 쿼리를 수정하고 **만들기** 를 선택합니다.

   ![사용자 지정 쿼리](./media/tutorial-hunting/custom-query.png)

## <a name="next-steps"></a>다음 단계
이 문서에서는 Azure Sentinel로 헌팅 조사를 실행하는 방법에 대해 알아보았습니다. Azure Sentinel에 대한 자세한 내용은 다음 문서를 참조하세요.


- [Notebook을 사용하여 자동화된 헌팅 캠페인 실행](notebooks.md)
- [헌팅 시 책갈피를 사용하여 흥미로운 정보 저장하기](bookmarks.md)