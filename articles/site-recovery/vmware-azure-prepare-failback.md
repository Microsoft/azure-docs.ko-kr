---
title: Azure Site Recovery를 사용하여 다시 보호 및 장애 복구를 위해 VMware VM 준비
description: Azure Site Recovery로 장애 조치 후 VMware VM 장애 복구 준비
ms.topic: conceptual
ms.date: 12/24/2019
ms.openlocfilehash: f3e352577d65bda021f886d6612c8c0101922003
ms.sourcegitcommit: 32e0fedb80b5a5ed0d2336cea18c3ec3b5015ca1
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/30/2021
ms.locfileid: "105727509"
---
# <a name="prepare-for-reprotection-and-failback-of-vmware-vms"></a>VMware VM의 장애 복구(failback) 및 다시 보호 준비

온-프레미스 VMware VM 또는 물리적 서버를 Azure로 [장애 조치(failver)](site-recovery-failover.md)하고 나면, 장애 조치 후 만든 Azure VM을 다시 보호하므로 온-프레미스 사이트로 다시 복제합니다. Azure에서 온-프레미스로의 복제를 사용하는 경우 준비가 되면 Azure에서 온-프레미스로 장애 조치를 실행하여 장애 복구(failback)를 수행할 수 있습니다.

계속하기 전에 다음 동영상을 시청하여 Azure에서 온-프레미스 사이트로 장애 복구하는 방법에 관한 개요를 확인하세요.<br /><br />
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video5-Failback-from-Azure-to-On-premises/player]

## <a name="reprotectionfailback-components"></a>다시 보호/장애 복구 구성 요소

Azure에서 다시 보호하고 장애 복구하려면 먼저 여러 구성 요소와 설정이 필요합니다.

| **구성 요소**| **세부 정보** |
| --- | --- |
| **온-프레미스 구성 서버** | 온-프레미스 구성 서버가 실행 중이고 Azure에 연결되어 있어야 합니다.<br/><br/> 장애 복구할 VM은 구성 서버 데이터베이스에 있어야 합니다. 재해가 구성 서버에 영향을 미치면 같은 IP 주소로 복원하여 장애 복구가 작동하는지 확인합니다.<br/><br/>  복제된 머신의 IP 주소가 장애 조치 시 유지된 경우 Azure VM 머신과 구성 서버의 장애 복구 NIC 간에 사이트 간 연결(또는 ExpressRoute 연결)을 설정해야 합니다. 유지된 IP 주소의 경우 구성 서버에는 원본 머신 연결용과 Azure 장애 복구 연결용으로 하나씩 두 개의 NIC가 필요합니다. 그러면 원본 및 장애 조치된 VM의 서브넷 주소 범위가 겹치지 않습니다. |
| **Azure의 프로세스 서버** | 온-프레미스 사이트에 장애 복구(를 수행하기 전에 Azure에 프로세스 서버가 필요합니다.<br/><br/> 프로세스 서버는 보호된 Azure VM에서 데이터를 수신한 다음, 온-프레미스 사이트로 보냅니다.<br/><br/> 프로세스 서버와 보호된 VM 간에 대기 시간이 낮은 네트워크가 필요하므로 복제 성능을 높이려면 Azure에 프로세스 서버를 배포하는 것이 좋습니다.<br/><br/> 개념 증명을 위해 개인 피어링으로 ExpressRoute 및 온-프레미스 프로세스 서버를 사용할 수 있습니다.<br/><br/> 프로세스 서버는 장애 조치된 VM이 있는 Azure 네트워크에 있어야 합니다. 이 프로세스 서버도 온-프레미스 구성 서버 및 마스터 대상 서버와 통신할 수 있어야 합니다. |
| **개별 마스터 대상 서버** | 마스터 대상 서버는 장애 복구 데이터를 수신하고, Windows 마스터 대상 서버는 기본적으로 온-프레미스 구성 서버에서 실행됩니다.<br/><br/> 마스터 대상 서버에는 최대 60개의 디스크가 연결되어 있을 수 있습니다. 장애 복구 중인 VM에 총 60개가 넘는 디스크가 있거나 대량의 트래픽을 장애 복구하는 경우 장애 복구를 위한 별도의 마스터 대상 서버를 만듭니다.<br/><br/> 다중 VM 일관성을 위해 머신을 복제 그룹으로 수집하는 경우, VM은 모두 Windows이거나 모두 Linux여야 합니다. 그 이유는 복제 그룹의 모든 VM은 같은 마스터 대상 서버를 사용해야 하고 마스터 대상 서버에는 복제된 머신과 같은 운영 체제(동일하거나 더 높은 버전)가 있어야 하기 때문입니다.<br/><br/> 마스터 대상 서버의 디스크에 스냅샷이 없어야 합니다. 그렇지 않으면 다시 보호 및 장애 복구가 작동하지 않습니다.<br/><br/> 마스터 대상에는 Paravirtual SCSI 컨트롤러가 있을 수 없습니다. 컨트롤러는 LSI Logic 컨트롤러 일 수 있습니다. LSI Logic 컨트롤러가 없으면 다시 보호가 실패합니다. |
| **장애 복구 복제 정책** | 온-프레미스 사이트에 다시 복제하려면 장애 복구 정책이 필요합니다. 이 정책은 Azure로의 복제 정책을 만들 때 자동으로 생성되었습니다.<br/><br/> 정책은 구성 서버와 자동으로 연결됩니다. RPO 임계값은 15분, 복구 지점 보존은 24시간, 앱 일관성 스냅샷 빈도는 60분으로 설정되어 있습니다. 정책은 편집할 수 없습니다. |
| **사이트 간 VPN/ExpressRoute 개인 피어링** | 다시 보호 및 장애 복구에는 사이트 간 VPN 연결 또는 데이터 복제를 위한 ExpressRoute 개인 피어링이 필요합니다. |


## <a name="ports-for-reprotectionfailback"></a>다시 보호/장애 복구를 위한 포트

다시 보호/장애 복구를 위해 여러 포트가 열려 있어야 합니다. 다음 그래픽은 포트 및 다시 보호/장애 복구 흐름을 보여 줍니다.

![장애 조치 및 장애 복구용 포트](./media/vmware-azure-reprotect/failover-failback.png)


## <a name="deploy-a-process-server-in-azure"></a>Azure에서 프로세스 서버 배포

1. 장애 복구를 위해 Azure에서 [프로세스 서버를 설정](vmware-azure-set-up-process-server-azure.md)합니다.
2. Azure VM이 프로세스 서버에 연결할 수 있는지 확인합니다. 
3. 사이트 간 VPN 연결 또는 ExpressRoute 개인 피어링 네트워크에 프로세스 서버에서 온-프레미스 사이트로 데이터를 보내기에 충분한 대역폭이 있는지 확인합니다.

## <a name="deploy-a-separate-master-target-server"></a>개별 마스터 대상 서버 배포

1. 마스터 대상 서버 [요구 사항 및 제한 사항](#reprotectionfailback-components)에 유의하세요.
2. 다시 보호하고 장애 복구하려는 VM의 운영 체제와 일치하도록 [Windows](site-recovery-plan-capacity-vmware.md#deploy-additional-master-target-servers) 또는 [Linux](vmware-azure-install-linux-master-target.md) 마스터 대상 서버를 만듭니다.
3. 마스터 대상 서버에 Storage vMotion을 사용하지 않는지 확인합니다. 그렇지 않으면 장애 복구가 실패할 수 있습니다. 디스크를 사용할 수 없으므로 VM 머신을 시작할 수 없습니다.
    - 이 문제를 방지하려면 vMotion 목록에서 마스터 대상 서버를 제외합니다.
    - 마스터 대상에서 다시 보호 후 Storage vMotion 작업을 수행하는 경우 마스터 대상 서버에 연결되어 있는 보호된 VM 디스크가 vMotion 작업 대상으로 마이그레이션됩니다. 이후에 장애 복구를 시도하면 디스크를 찾을 수 없기 때문에 디스크 분리에 실패합니다. 그러면 스토리지 계정에서 디스크를 찾기가 어렵습니다. 이 문제가 발생하면 수동으로 찾아서 VM에 연결합니다. 그런 다음 온-프레미스 VM을 부팅할 수 있습니다.

4. 기존 Windows 마스터 대상 서버에 새 보존 드라이브를 추가합니다. 새 디스크를 추가하고 드라이브를 포맷합니다. 보존 드라이브는 VM에서 온-프레미스 사이트로 다시 복제할 때 특정 시점을 중지하는 데 사용됩니다. 해당 조건을 확인합니다. 해당 기준이 충족되지 않으면 드라이브가 마스터 대상 서버에 나열되지 않습니다.
    - 볼륨은 복제 대상과 같은 다른 용도로 사용되지 않으며 잠금 모드가 아닙니다.
    - 볼륨은 캐시 볼륨이 아닙니다. 프로세스 서버와 마스터 대상에 대한 사용자 지정 설치 볼륨은 보존 볼륨에 적합하지 않습니다. 프로세스 서버와 마스터 대상이 볼륨에 설치되면 이 볼륨은 마스터 대상의 캐시 볼륨입니다.
    - 볼륨의 파일 시스템 형식은 FAT 또는 FAT32가 아닙니다.
    - 볼륨 용량은 0이 아닌 값입니다.
    - Windows의 기본 보존 볼륨은 R 볼륨입니다.
    - Linux의 기본 보존 볼륨은 /mnt/retention입니다.

5. 기존 프로세스 서버를 사용하는 경우 드라이브를 추가합니다. 새 드라이브가 마지막 단계에서 요구 사항을 충족해야 합니다. 보존 드라이브가 없으면 포털의 드롭다운 목록에 선택 사항이 나열되지 않습니다. 온-프레미스 마스터 대상에 드라이브를 추가하고 나면 드라이브가 포털의 선택 사항에 나타나는 데 최대 15분이 걸립니다. 15분 후에도 드라이브가 표시되지 않으면 구성 서버를 새로 고칠 수 있습니다.
6. 마스터 대상 서버에 VMware 도구 또는 open-vm-tools를 설치합니다. 도구가 없으면 마스터 대상의 ESXi 호스트에 있는 데이터 저장소를 검색할 수 없습니다.
7. VMware의 마스터 대상 VM 구성 매개 변수에서 disk.EnableUUID=true로 설정합니다. 이 행이 없는 경우 추가합니다. 올바르게 탑재할 수 있도록 VMDK에 일관성 있는 UUID를 제공하려면 이 설정이 필요합니다.
8. 다음과 같은 vCenter Server 액세스 요구 사항을 확인합니다.
    - 장애 복구할 VM이 VMware vCenter Server에서 관리하는 ESXi 호스트에 있는 경우 마스터 대상 서버는 복제된 데이터를 가상 머신의 디스크에 쓰기 위해 온-프레미스 VMDK(VM Virtual Machine Disk) 파일에 액세스해야 합니다. 읽기/쓰기 권한으로 온-프레미스 VM 데이터 저장소를 마스터 대상의 호스트에 탑재했는지 확인합니다.
    - VMware vCenter Server에서 관리하는 ESXi 호스트에 VM이 없는 경우 Site Recovery가 다시 보호하는 동안 새 VM을 만듭니다. 이 VM은 마스터 대상 서버 VM을 만드는 ESXi 호스트에서 생성됩니다. ESXi 호스트를 신중하게 선택하여 원하는 호스트에 VM을 만듭니다. VM의 하드 디스크는 마스터 대상 서버가 실행 중인 호스트에서 액세스할 수 있는 데이터 저장소에 있어야 합니다.
    - 장애 복구(Failback)를 위한 온-프레미스 VM이 이미 있는 경우의 또 다른 옵션은 장애 복구(Failback)를 수행하기 전에 해당 VM을 삭제하는 것입니다. 그런 다음 장애 복구를 수행하면 마스터 대상 ESXi 호스트와 같은 호스트에 새 VM을 만듭니다. 대체 위치로 장애 복구하는 경우 온-프레미스 마스터 대상 서버에서 사용한 것과 같은 데이터 저장소와 같은 ESXi 호스트에 데이터를 복구합니다.
9. VMware VM으로 장애 복구하는 물리적 머신의 경우 머신을 다시 보호하기 전에 마스터 대상 서버가 실행되는 호스트의 검색을 완료해야 합니다.
10. 마스터 대상 VM이 있는 ESXi 호스트에 하나 이상의 VMFS(가상 머신 파일 시스템) 데이터 저장소가 연결되어 있는지 확인합니다. VMFS 데이터 저장소가 연결되지 않은 경우 다시 보호 설정의 데이터 저장소 입력이 비어 있어 계속 진행할 수 없습니다.


## <a name="next-steps"></a>다음 단계

VM을 [다시 보호](vmware-azure-reprotect.md)합니다.
